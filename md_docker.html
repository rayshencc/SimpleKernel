<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SimpleKernel: Docker 开发环境配置</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SimpleKernel<span id="projectnumber">&#160;1.17.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docker.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Docker 开发环境配置</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md227"></a> 本文档介绍如何使用 Docker 搭建 SimpleKernel 的开发环境，支持两种方式：使用预构建镜像或自建镜像。</p>
<h1><a class="anchor" id="autotoc_md228"></a>
目录</h1>
<ul>
<li>快速开始（推荐）</li>
<li>自建镜像</li>
<li>SSH 配置</li>
<li>VSCode 远程开发</li>
<li>常用命令</li>
</ul>
<h1><a class="anchor" id="autotoc_md229"></a>
快速开始（推荐）</h1>
<h2><a class="anchor" id="autotoc_md230"></a>
1. 拉取并运行预构建镜像</h2>
<div class="fragment"><div class="line"># 进入项目目录</div>
<div class="line">cd SimpleKernel</div>
<div class="line"> </div>
<div class="line"># 拉取最新镜像</div>
<div class="line">docker pull ptrnull233/simple_kernel:latest</div>
<div class="line"> </div>
<div class="line"># 启动容器（包含完整的挂载配置）</div>
<div class="line">docker run --name SimpleKernel-container -itd \</div>
<div class="line">  -p 233:22 \</div>
<div class="line">  -v ./:/root/SimpleKernel \</div>
<div class="line">  -v ~/.ssh:/root/.ssh \</div>
<div class="line">  -v ~/.gitconfig:/root/.gitconfig \</div>
<div class="line">  ptrnull233/simple_kernel:latest</div>
<div class="line"> </div>
<div class="line"># 进入容器</div>
<div class="line">docker exec -it SimpleKernel-container /bin/zsh</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md231"></a>
2. 验证环境</h2>
<p>进入容器后，验证开发工具是否正常：</p>
<div class="fragment"><div class="line"># 检查编译器</div>
<div class="line">gcc --version</div>
<div class="line">clang --version</div>
<div class="line"> </div>
<div class="line"># 检查交叉编译工具链</div>
<div class="line">aarch64-linux-gnu-gcc --version</div>
<div class="line">riscv64-linux-gnu-gcc --version</div>
<div class="line"> </div>
<div class="line"># 检查构建工具</div>
<div class="line">cmake --version</div>
<div class="line">make --version</div>
<div class="line"> </div>
<div class="line"># 尝试构建项目</div>
<div class="line">cd /root/SimpleKernel</div>
<div class="line">mkdir -p build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md232"></a>
自建镜像</h1>
<p>如果需要自定义镜像或预构建镜像不可用：</p>
<h2><a class="anchor" id="autotoc_md233"></a>
1. 构建镜像</h2>
<div class="fragment"><div class="line">cd SimpleKernel</div>
<div class="line">docker buildx build -t simple_kernel-docker-image ./tools</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md234"></a>
2. 启动自建镜像容器</h2>
<div class="fragment"><div class="line">docker run --name SimpleKernel-container -itd \</div>
<div class="line">  -p 233:22 \</div>
<div class="line">  -v ./:/root/SimpleKernel \</div>
<div class="line">  -v ~/.ssh:/root/.ssh \</div>
<div class="line">  -v ~/.gitconfig:/root/.gitconfig \</div>
<div class="line">  simple_kernel-docker-image</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md235"></a>
3. 进入容器</h2>
<div class="fragment"><div class="line">docker exec -it SimpleKernel-container /bin/zsh</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md236"></a>
SSH 配置</h1>
<p>为了更好的开发体验，可以配置 SSH 远程访问：</p>
<h2><a class="anchor" id="autotoc_md237"></a>
1. 生成 SSH 密钥（本地）</h2>
<div class="fragment"><div class="line"># 检查是否已存在 SSH 密钥</div>
<div class="line">ls ~/.ssh/</div>
<div class="line"> </div>
<div class="line"># 如果不存在，生成新的 RSA 密钥</div>
<div class="line"># 将 &lt;your-email&gt; 替换为你的邮箱</div>
<div class="line">ssh-keygen -t rsa -b 4096 -C &quot;&lt;your-email&gt;&quot;</div>
<div class="line"> </div>
<div class="line"># 查看公钥内容</div>
<div class="line">cat ~/.ssh/id_rsa.pub</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md238"></a>
2. 配置容器 SSH 访问</h2>
<div class="fragment"><div class="line"># 通过 SSH 连接到容器（首次需要密码）</div>
<div class="line">ssh -p 233 zone@localhost</div>
<div class="line"># 默认密码：zone</div>
<div class="line"> </div>
<div class="line"># 在容器内创建 SSH 目录和授权文件</div>
<div class="line">mkdir -p /home/zone/.ssh</div>
<div class="line">touch /home/zone/.ssh/authorized_keys</div>
<div class="line">chmod 700 /home/zone/.ssh</div>
<div class="line">chmod 600 /home/zone/.ssh/authorized_keys</div>
<div class="line"> </div>
<div class="line"># 将本地公钥内容添加到 authorized_keys</div>
<div class="line"># 可以通过 docker exec 或直接编辑文件</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md239"></a>
3. 验证 SSH 免密登录</h2>
<div class="fragment"><div class="line"># 现在应该可以免密登录</div>
<div class="line">ssh -p 233 zone@localhost</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md240"></a>
VSCode 远程开发</h1>
<h2><a class="anchor" id="autotoc_md241"></a>
1. 安装插件</h2>
<p>在 VSCode 中安装以下插件：</p><ul>
<li><code>Remote - SSH</code></li>
<li><code>Remote - Containers</code> (可选)</li>
</ul>
<h2><a class="anchor" id="autotoc_md242"></a>
2. 配置 SSH 连接</h2>
<ol type="1">
<li>打开命令面板：<code>Ctrl+Shift+P</code> (Windows/Linux) 或 <code>Cmd+Shift+P</code> (macOS)</li>
<li>输入：<code>Remote-SSH: Add New SSH Host...</code></li>
<li>输入 SSH 命令：<code>ssh -p 233 zone@localhost</code></li>
<li>选择配置文件保存位置</li>
</ol>
<h2><a class="anchor" id="autotoc_md243"></a>
3. 连接并打开项目</h2>
<ol type="1">
<li>打开命令面板：<code>Ctrl+Shift+P</code> / <code>Cmd+Shift+P</code></li>
<li>输入：<code>Remote-SSH: Connect to Host...</code></li>
<li>选择 <code>zone@localhost</code></li>
<li>在新窗口中打开文件夹：<code>/home/zone/SimpleKernel</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md244"></a>
4. 推荐插件（远程环境）</h2>
<p>在远程环境中安装以下插件以获得更好的开发体验：</p><ul>
<li>C/C++ Extension Pack</li>
<li>CMake Tools</li>
<li>GitLens</li>
<li>Clang-Format</li>
</ul>
<h1><a class="anchor" id="autotoc_md245"></a>
常用命令</h1>
<h2><a class="anchor" id="autotoc_md246"></a>
容器管理</h2>
<div class="fragment"><div class="line"># 查看容器状态</div>
<div class="line">docker ps -a</div>
<div class="line"> </div>
<div class="line"># 启动已停止的容器</div>
<div class="line">docker start SimpleKernel-container</div>
<div class="line"> </div>
<div class="line"># 停止容器</div>
<div class="line">docker stop SimpleKernel-container</div>
<div class="line"> </div>
<div class="line"># 重启容器</div>
<div class="line">docker restart SimpleKernel-container</div>
<div class="line"> </div>
<div class="line"># 删除容器</div>
<div class="line">docker rm SimpleKernel-container</div>
<div class="line"> </div>
<div class="line"># 查看容器日志</div>
<div class="line">docker logs SimpleKernel-container</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md247"></a>
镜像管理</h2>
<div class="fragment"><div class="line"># 查看本地镜像</div>
<div class="line">docker images</div>
<div class="line"> </div>
<div class="line"># 删除镜像</div>
<div class="line">docker rmi simple_kernel-docker-image</div>
<div class="line"> </div>
<div class="line"># 清理未使用的镜像</div>
<div class="line">docker image prune</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md248"></a>
文件传输</h2>
<div class="fragment"><div class="line"># 从容器复制文件到主机</div>
<div class="line">docker cp SimpleKernel-container:/path/to/file /host/path/</div>
<div class="line"> </div>
<div class="line"># 从主机复制文件到容器</div>
<div class="line">docker cp /host/path/file SimpleKernel-container:/path/to/</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md249"></a>
故障排除</h1>
<h2><a class="anchor" id="autotoc_md250"></a>
常见问题</h2>
<ol type="1">
<li><b>端口 233 已被占用</b> <div class="fragment"><div class="line"># 检查端口占用</div>
<div class="line">lsof -i :233</div>
<div class="line"># 或使用其他端口</div>
<div class="line">docker run -p 234:22 ...</div>
</div><!-- fragment --></li>
<li><b>容器启动失败</b> <div class="fragment"><div class="line"># 查看详细错误信息</div>
<div class="line">docker logs SimpleKernel-container</div>
</div><!-- fragment --></li>
<li><b>挂载目录权限问题</b> <div class="fragment"><div class="line"># 检查目录权限</div>
<div class="line">ls -la ./</div>
<div class="line"># 确保 Docker 有权限访问挂载目录</div>
</div><!-- fragment --></li>
<li><b>SSH 连接失败</b> <div class="fragment"><div class="line"># 检查容器是否在运行</div>
<div class="line">docker ps</div>
<div class="line"># 检查 SSH 服务状态</div>
<div class="line">docker exec -it SimpleKernel-container systemctl status ssh</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md251"></a>
重置环境</h2>
<p>如果遇到无法解决的问题，可以重置整个环境：</p>
<div class="fragment"><div class="line"># 停止并删除容器</div>
<div class="line">docker stop SimpleKernel-container</div>
<div class="line">docker rm SimpleKernel-container</div>
<div class="line"> </div>
<div class="line"># 重新创建容器</div>
<div class="line">docker run --name SimpleKernel-container -itd \</div>
<div class="line">  -p 233:22 \</div>
<div class="line">  -v ./:/root/SimpleKernel \</div>
<div class="line">  -v ~/.ssh:/root/.ssh \</div>
<div class="line">  -v ~/.gitconfig:/root/.gitconfig \</div>
<div class="line">  ptrnull233/simple_kernel:latest</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
