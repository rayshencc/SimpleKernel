<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SimpleKernel: /root/src/syscall.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SimpleKernel<span id="projectnumber">&#160;1.17.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('syscall_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">syscall.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="syscall_8hpp_source.html">syscall.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="kernel__log_8hpp_source.html">kernel_log.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="singleton_8hpp_source.html">singleton.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__manager_8hpp_source.html">task_manager.hpp</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for syscall.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp__incl.png" border="0" usemap="#a_2root_2src_2syscall_8cpp" alt=""/></div>
<map name="a_2root_2src_2syscall_8cpp" id="a_2root_2src_2syscall_8cpp">
<area shape="rect" title=" " alt="" coords="1425,5,1575,31"/>
<area shape="rect" href="syscall_8hpp.html" title=" " alt="" coords="381,225,475,251"/>
<area shape="poly" title=" " alt="" coords="1424,23,1099,31,656,52,439,69,249,91,172,104,108,119,61,136,34,154,29,165,34,176,56,192,89,205,178,222,279,231,367,234,367,239,278,237,178,228,87,210,53,196,30,179,24,165,30,150,59,131,106,114,170,99,249,86,438,63,656,46,1099,26,1424,18"/>
<area shape="rect" href="kernel__log_8hpp.html" title=" " alt="" coords="2033,152,2151,177"/>
<area shape="poly" title=" " alt="" coords="1548,28,2033,146,2031,151,1546,33"/>
<area shape="rect" href="singleton_8hpp.html" title=" " alt="" coords="2413,299,2523,324"/>
<area shape="poly" title=" " alt="" coords="1563,28,1815,76,1919,89,2014,91,2182,83,2259,89,2295,97,2331,109,2367,128,2402,152,2437,184,2472,224,2479,238,2482,254,2479,285,2473,285,2477,255,2474,240,2467,227,2433,188,2399,156,2364,132,2329,114,2294,102,2258,94,2182,89,2014,96,1919,95,1814,81,1562,33"/>
<area shape="rect" href="task__manager_8hpp.html" title=" " alt="" coords="838,79,981,104"/>
<area shape="poly" title=" " alt="" coords="1425,31,995,82,994,77,1424,26"/>
<area shape="rect" href="cpu__io_8h.html" title=" " alt="" coords="959,299,1035,324"/>
<area shape="poly" title=" " alt="" coords="476,243,946,301,946,306,475,248"/>
<area shape="rect" title=" " alt="" coords="327,445,398,471"/>
<area shape="poly" title=" " alt="" coords="381,245,350,250,318,261,288,277,265,300,251,325,248,347,252,370,265,396,287,421,316,438,313,443,284,425,260,399,247,372,242,347,246,323,261,297,285,273,316,256,349,245,380,240"/>
<area shape="rect" title=" " alt="" coords="1240,445,1307,471"/>
<area shape="poly" title=" " alt="" coords="451,248,523,284,617,321,681,339,733,348,785,356,851,369,942,395,1098,426,1227,447,1226,452,1097,431,941,400,850,375,784,361,732,354,680,344,615,327,521,289,448,253"/>
<area shape="rect" title=" " alt="" coords="1311,372,1377,397"/>
<area shape="poly" title=" " alt="" coords="1036,318,1298,371,1297,376,1035,323"/>
<area shape="rect" title=" " alt="" coords="1065,372,1135,397"/>
<area shape="poly" title=" " alt="" coords="1015,322,1073,362,1070,366,1012,326"/>
<area shape="poly" title=" " alt="" coords="960,323,940,327,846,340,773,347,700,356,607,375,496,408,403,443,402,438,494,403,606,369,699,350,772,342,846,335,940,321,959,318"/>
<area shape="poly" title=" " alt="" coords="1033,322,1088,342,1148,370,1203,403,1249,435,1246,439,1200,407,1145,374,1086,347,1031,327"/>
<area shape="rect" title=" " alt="" coords="589,445,653,471"/>
<area shape="poly" title=" " alt="" coords="960,323,940,327,867,332,772,335,724,339,682,346,647,357,623,374,616,386,613,401,616,432,611,432,608,401,611,385,619,370,644,352,680,341,724,334,772,330,867,326,940,321,959,318"/>
<area shape="rect" title=" " alt="" coords="813,445,877,471"/>
<area shape="poly" title=" " alt="" coords="987,326,869,438,866,434,983,323"/>
<area shape="rect" title=" " alt="" coords="923,445,1047,471"/>
<area shape="poly" title=" " alt="" coords="1000,324,999,398,993,432,988,431,993,397,995,324"/>
<area shape="rect" href="test__environment__state_8hpp.html" title=" " alt="" coords="633,372,839,397"/>
<area shape="poly" title=" " alt="" coords="960,326,792,371,790,366,959,320"/>
<area shape="poly" title=" " alt="" coords="677,400,412,450,411,445,676,395"/>
<area shape="poly" title=" " alt="" coords="823,395,1226,448,1226,453,822,400"/>
<area shape="poly" title=" " alt="" coords="719,400,653,440,650,436,716,395"/>
<area shape="poly" title=" " alt="" coords="755,395,817,435,814,440,752,400"/>
<area shape="poly" title=" " alt="" coords="777,395,932,439,931,444,775,400"/>
<area shape="rect" title=" " alt="" coords="705,445,767,471"/>
<area shape="poly" title=" " alt="" coords="739,398,739,432,733,432,733,398"/>
<area shape="poly" title=" " alt="" coords="2091,178,2050,304,2017,399,1976,415,1905,427,1705,444,1487,454,1321,459,1320,453,1486,449,1705,439,1905,421,1975,409,2013,395,2045,303,2086,177"/>
<area shape="rect" title=" " alt="" coords="777,299,833,324"/>
<area shape="poly" title=" " alt="" coords="2033,169,1879,171,1660,180,1407,197,1277,211,1150,228,1065,244,981,263,847,300,846,295,980,258,1064,238,1149,223,1276,206,1406,192,1660,174,1879,166,2033,163"/>
<area shape="rect" title=" " alt="" coords="2211,225,2282,251"/>
<area shape="poly" title=" " alt="" coords="2118,175,2210,217,2208,222,2116,180"/>
<area shape="rect" title=" " alt="" coords="2306,225,2430,251"/>
<area shape="poly" title=" " alt="" coords="2137,175,2311,219,2309,224,2136,180"/>
<area shape="poly" title=" " alt="" coords="2151,166,2228,172,2315,182,2392,199,2423,210,2444,223,2456,237,2463,252,2470,284,2465,285,2458,254,2451,240,2441,227,2420,215,2391,204,2314,187,2228,177,2151,171"/>
<area shape="rect" title=" " alt="" coords="1876,299,1959,324"/>
<area shape="poly" title=" " alt="" coords="2079,180,1943,292,1940,288,2076,176"/>
<area shape="rect" title=" " alt="" coords="2085,225,2187,251"/>
<area shape="poly" title=" " alt="" coords="2102,176,2124,212,2119,215,2097,179"/>
<area shape="rect" href="spinlock_8hpp.html" title=" " alt="" coords="1557,225,1661,251"/>
<area shape="poly" title=" " alt="" coords="2034,177,1675,230,1674,224,2033,172"/>
<area shape="poly" title=" " alt="" coords="1557,248,1049,307,1049,301,1557,243"/>
<area shape="poly" title=" " alt="" coords="1589,253,1378,368,1376,363,1587,249"/>
<area shape="poly" title=" " alt="" coords="1557,246,1220,272,1048,288,949,301,921,314,893,327,837,340,789,346,705,348,623,352,576,360,521,375,497,386,475,400,397,441,395,437,472,395,495,381,519,369,574,354,622,347,705,343,788,341,836,334,891,321,919,309,947,296,1047,282,1219,266,1557,240"/>
<area shape="poly" title=" " alt="" coords="1659,248,1863,295,1862,300,1658,253"/>
<area shape="rect" title=" " alt="" coords="1772,299,1852,324"/>
<area shape="poly" title=" " alt="" coords="1643,248,1767,292,1766,297,1641,253"/>
<area shape="rect" title=" " alt="" coords="1689,299,1748,324"/>
<area shape="poly" title=" " alt="" coords="1628,248,1691,289,1688,293,1625,253"/>
<area shape="rect" href="expected_8hpp.html" title=" " alt="" coords="1554,299,1665,324"/>
<area shape="poly" title=" " alt="" coords="1612,251,1612,285,1607,285,1607,251"/>
<area shape="poly" title=" " alt="" coords="1614,324,1615,361,1610,381,1599,399,1579,413,1550,425,1475,442,1393,452,1321,457,1320,452,1392,447,1475,436,1549,420,1577,408,1595,396,1605,379,1610,360,1609,324"/>
<area shape="rect" title=" " alt="" coords="1503,372,1585,397"/>
<area shape="poly" title=" " alt="" coords="1601,326,1566,364,1562,360,1597,323"/>
<area shape="poly" title=" " alt="" coords="970,102,1011,120,1029,133,1044,151,1052,168,1055,187,1049,224,1034,260,1017,289,1012,286,1029,257,1044,223,1049,187,1046,170,1039,153,1025,137,1008,124,968,107"/>
<area shape="poly" title=" " alt="" coords="838,96,637,98,384,107,262,114,157,125,77,138,50,146,34,154,17,171,10,189,9,237,9,312,12,324,18,335,42,356,79,377,124,395,225,425,314,445,313,450,224,430,123,400,77,381,39,361,14,338,7,326,4,313,4,237,5,188,13,169,30,150,48,141,76,133,156,119,262,109,384,102,637,93,838,90"/>
<area shape="poly" title=" " alt="" coords="981,92,1242,103,1409,113,1580,127,1739,146,1872,170,1924,184,1964,199,1989,216,1996,226,1999,236,1999,313,1993,338,1975,361,1949,380,1914,396,1825,422,1719,440,1605,451,1494,457,1320,460,1320,455,1493,452,1604,446,1718,435,1824,417,1912,391,1946,375,1972,357,1988,336,1993,312,1993,237,1991,228,1985,220,1961,204,1922,189,1871,175,1738,151,1579,133,1408,118,1242,108,981,97"/>
<area shape="poly" title=" " alt="" coords="941,102,973,121,988,134,1000,151,1003,164,1000,178,981,220,948,253,898,283,848,302,846,297,896,278,945,249,977,217,995,176,998,164,995,153,984,138,970,125,938,106"/>
<area shape="poly" title=" " alt="" coords="981,91,1111,95,1269,105,1417,122,1477,135,1522,150,1544,163,1564,179,1595,212,1591,216,1561,183,1541,167,1520,154,1476,140,1416,128,1268,110,1111,101,981,96"/>
<area shape="poly" title=" " alt="" coords="980,101,1074,119,1191,145,1319,180,1445,223,1518,256,1579,289,1577,294,1516,261,1443,228,1318,185,1190,150,1073,124,979,107"/>
<area shape="rect" title=" " alt="" coords="44,152,177,177"/>
<area shape="poly" title=" " alt="" coords="838,100,559,120,191,155,191,149,558,115,837,94"/>
<area shape="rect" href="interrupt__base_8h.html" title=" " alt="" coords="1304,225,1432,251"/>
<area shape="poly" title=" " alt="" coords="957,102,1131,149,1326,218,1324,223,1130,155,956,107"/>
<area shape="rect" href="per__cpu_8hpp.html" title=" " alt="" coords="1161,225,1263,251"/>
<area shape="poly" title=" " alt="" coords="958,101,1023,121,1093,150,1146,182,1190,214,1186,219,1143,186,1091,154,1022,126,957,107"/>
<area shape="rect" href="resource__id_8hpp.html" title=" " alt="" coords="628,299,753,324"/>
<area shape="poly" title=" " alt="" coords="888,106,852,127,814,154,780,187,750,224,706,288,702,285,746,220,776,184,810,150,849,122,885,102"/>
<area shape="rect" href="scheduler__base_8hpp.html" title=" " alt="" coords="834,152,985,177"/>
<area shape="poly" title=" " alt="" coords="912,104,912,138,907,138,907,104"/>
<area shape="rect" href="task__control__block_8hpp.html" title=" " alt="" coords="762,225,934,251"/>
<area shape="poly" title=" " alt="" coords="880,106,849,125,835,138,824,153,820,168,821,183,834,213,829,215,816,184,814,167,819,151,831,134,845,121,878,102"/>
<area shape="rect" title=" " alt="" coords="201,152,265,177"/>
<area shape="poly" title=" " alt="" coords="838,98,594,115,439,132,279,155,278,150,438,126,593,110,838,93"/>
<area shape="rect" title=" " alt="" coords="289,152,428,177"/>
<area shape="poly" title=" " alt="" coords="838,104,442,154,441,149,837,99"/>
<area shape="rect" title=" " alt="" coords="452,152,599,177"/>
<area shape="poly" title=" " alt="" coords="848,107,601,152,601,147,847,101"/>
<area shape="rect" title=" " alt="" coords="623,152,708,177"/>
<area shape="poly" title=" " alt="" coords="871,107,719,151,717,146,869,101"/>
<area shape="poly" title=" " alt="" coords="1309,253,1050,303,1049,298,1308,248"/>
<area shape="poly" title=" " alt="" coords="1379,250,1397,278,1415,316,1423,358,1420,379,1412,399,1393,419,1370,434,1321,452,1319,447,1368,430,1390,415,1407,396,1415,378,1418,358,1410,317,1392,280,1375,253"/>
<area shape="poly" title=" " alt="" coords="1408,248,1558,292,1556,297,1406,253"/>
<area shape="poly" title=" " alt="" coords="1178,253,1046,297,1044,292,1177,248"/>
<area shape="poly" title=" " alt="" coords="1264,247,1306,266,1325,280,1341,297,1348,312,1352,328,1351,358,1346,358,1346,328,1343,314,1336,300,1322,283,1303,270,1262,252"/>
<area shape="poly" title=" " alt="" coords="1162,248,1043,267,973,282,904,301,875,314,846,327,790,339,742,344,658,344,618,344,576,347,530,356,477,374,451,388,426,404,386,438,382,433,423,400,448,383,475,370,529,351,576,342,618,339,658,339,742,339,790,334,845,321,873,309,902,296,971,277,1042,262,1161,243"/>
<area shape="poly" title=" " alt="" coords="1264,246,1315,264,1341,278,1363,297,1377,314,1385,331,1392,371,1395,385,1392,399,1377,416,1360,430,1321,448,1319,443,1357,425,1374,412,1387,396,1390,385,1387,373,1380,333,1373,317,1359,301,1338,283,1313,269,1262,251"/>
<area shape="poly" title=" " alt="" coords="1162,249,1022,271,853,301,847,302,846,297,851,296,1021,265,1161,244"/>
<area shape="poly" title=" " alt="" coords="1263,245,1292,248,1616,273,1934,291,2399,306,2399,311,1934,296,1616,279,1292,253,1262,250"/>
<area shape="rect" title=" " alt="" coords="1252,299,1327,324"/>
<area shape="poly" title=" " alt="" coords="1226,249,1268,287,1265,291,1223,253"/>
<area shape="rect" title=" " alt="" coords="1162,299,1227,324"/>
<area shape="poly" title=" " alt="" coords="1212,252,1203,286,1198,285,1207,250"/>
<area shape="poly" title=" " alt="" coords="738,321,1228,443,1226,448,736,327"/>
<area shape="rect" title=" " alt="" coords="319,372,406,397"/>
<area shape="poly" title=" " alt="" coords="639,327,420,374,419,368,637,321"/>
<area shape="poly" title=" " alt="" coords="834,173,585,193,459,209,369,228,296,251,270,269,246,300,240,317,236,341,238,368,249,396,262,412,278,424,315,442,313,447,276,429,258,415,244,399,233,370,231,340,235,315,242,297,266,265,294,246,367,223,458,203,584,188,834,168"/>
<area shape="poly" title=" " alt="" coords="928,175,1093,283,1219,370,1245,401,1264,432,1259,435,1240,404,1216,374,1090,288,925,180"/>
<area shape="poly" title=" " alt="" coords="901,179,869,217,865,213,897,176"/>
<area shape="poly" title=" " alt="" coords="873,248,962,290,959,295,871,253"/>
<area shape="poly" title=" " alt="" coords="762,250,641,266,504,292,439,308,383,327,338,349,309,374,304,389,309,405,321,421,337,435,333,439,317,424,304,407,298,389,304,370,335,345,381,322,438,303,503,286,640,261,761,245"/>
<area shape="poly" title=" " alt="" coords="897,248,970,268,1049,296,1119,330,1186,370,1224,402,1256,433,1252,437,1220,406,1182,374,1116,335,1047,301,968,273,896,253"/>
<area shape="poly" title=" " alt="" coords="843,252,821,288,817,286,839,250"/>
<area shape="poly" title=" " alt="" coords="824,253,730,295,728,291,822,248"/>
</map>
</div>
</div>
<p><a href="syscall_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9c01f57bb4ef6f1b91ccce212494a199" id="r_a9c01f57bb4ef6f1b91ccce212494a199"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#a9c01f57bb4ef6f1b91ccce212494a199">syscall_dispatcher</a> (int64_t syscall_id, uint64_t args[6])</td></tr>
<tr class="separator:a9c01f57bb4ef6f1b91ccce212494a199"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fa66935c10e294006b6310af1c68f37" id="r_a4fa66935c10e294006b6310af1c68f37"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#a4fa66935c10e294006b6310af1c68f37">sys_write</a> (int fd, const char *buf, size_t len)</td></tr>
<tr class="memdesc:a4fa66935c10e294006b6310af1c68f37"><td class="mdescLeft">&#160;</td><td class="mdescRight">向文件描述符写入数据  <br /></td></tr>
<tr class="separator:a4fa66935c10e294006b6310af1c68f37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34c7946fbbdfb071d2b453a745dcb9b4" id="r_a34c7946fbbdfb071d2b453a745dcb9b4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#a34c7946fbbdfb071d2b453a745dcb9b4">sys_exit</a> (int code)</td></tr>
<tr class="memdesc:a34c7946fbbdfb071d2b453a745dcb9b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">退出当前进程或线程  <br /></td></tr>
<tr class="separator:a34c7946fbbdfb071d2b453a745dcb9b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23ac80734740f098e56332da33758ace" id="r_a23ac80734740f098e56332da33758ace"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#a23ac80734740f098e56332da33758ace">sys_yield</a> ()</td></tr>
<tr class="memdesc:a23ac80734740f098e56332da33758ace"><td class="mdescLeft">&#160;</td><td class="mdescRight">主动放弃CPU，让出时间片  <br /></td></tr>
<tr class="separator:a23ac80734740f098e56332da33758ace"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83d46a7afcd47f11ed83ae871d058d20" id="r_a83d46a7afcd47f11ed83ae871d058d20"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#a83d46a7afcd47f11ed83ae871d058d20">sys_sleep</a> (uint64_t ms)</td></tr>
<tr class="memdesc:a83d46a7afcd47f11ed83ae871d058d20"><td class="mdescLeft">&#160;</td><td class="mdescRight">休眠指定毫秒数  <br /></td></tr>
<tr class="separator:a83d46a7afcd47f11ed83ae871d058d20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d9ce836fd264a98548781886f375d2a" id="r_a6d9ce836fd264a98548781886f375d2a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#a6d9ce836fd264a98548781886f375d2a">sys_clone</a> (uint64_t <a class="el" href="acpi_8h.html#a773b39d480759f67926cb18ae2219281">flags</a>, void *stack, int *parent_tid, int *child_tid, void *tls)</td></tr>
<tr class="memdesc:a6d9ce836fd264a98548781886f375d2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">创建新线程（或进程）  <br /></td></tr>
<tr class="separator:a6d9ce836fd264a98548781886f375d2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01fbd4b45143dd51bf6f338d8ee325da" id="r_a01fbd4b45143dd51bf6f338d8ee325da"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#a01fbd4b45143dd51bf6f338d8ee325da">sys_fork</a> ()</td></tr>
<tr class="memdesc:a01fbd4b45143dd51bf6f338d8ee325da"><td class="mdescLeft">&#160;</td><td class="mdescRight">创建新进程（fork）  <br /></td></tr>
<tr class="separator:a01fbd4b45143dd51bf6f338d8ee325da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17717d9e7bc25b272fe4dbb63bc52baa" id="r_a17717d9e7bc25b272fe4dbb63bc52baa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#a17717d9e7bc25b272fe4dbb63bc52baa">sys_gettid</a> ()</td></tr>
<tr class="memdesc:a17717d9e7bc25b272fe4dbb63bc52baa"><td class="mdescLeft">&#160;</td><td class="mdescRight">获取当前线程ID  <br /></td></tr>
<tr class="separator:a17717d9e7bc25b272fe4dbb63bc52baa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5c00759c95d8ce9e9db75b1b55a9552" id="r_ab5c00759c95d8ce9e9db75b1b55a9552"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#ab5c00759c95d8ce9e9db75b1b55a9552">sys_set_tid_address</a> (int *tidptr)</td></tr>
<tr class="memdesc:ab5c00759c95d8ce9e9db75b1b55a9552"><td class="mdescLeft">&#160;</td><td class="mdescRight">设置线程ID地址（用于线程退出时的清理）  <br /></td></tr>
<tr class="separator:ab5c00759c95d8ce9e9db75b1b55a9552"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa03f906affa67ef23ebfbcb79efa569f" id="r_aa03f906affa67ef23ebfbcb79efa569f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#aa03f906affa67ef23ebfbcb79efa569f">sys_futex</a> (int *uaddr, int op, int val, const void *timeout, int *uaddr2, int val3)</td></tr>
<tr class="memdesc:aa03f906affa67ef23ebfbcb79efa569f"><td class="mdescLeft">&#160;</td><td class="mdescRight">快速用户空间互斥锁操作（futex）  <br /></td></tr>
<tr class="separator:aa03f906affa67ef23ebfbcb79efa569f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dd37ef811b362b4638eb21fab7f09fc" id="r_a4dd37ef811b362b4638eb21fab7f09fc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#a4dd37ef811b362b4638eb21fab7f09fc">sys_sched_getaffinity</a> (int pid, size_t cpusetsize, uint64_t *mask)</td></tr>
<tr class="memdesc:a4dd37ef811b362b4638eb21fab7f09fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">获取线程的CPU亲和性  <br /></td></tr>
<tr class="separator:a4dd37ef811b362b4638eb21fab7f09fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc0c058ad3c8a4b5746d97c2f49b97a4" id="r_afc0c058ad3c8a4b5746d97c2f49b97a4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="syscall_8cpp.html#afc0c058ad3c8a4b5746d97c2f49b97a4">sys_sched_setaffinity</a> (int pid, size_t cpusetsize, const uint64_t *mask)</td></tr>
<tr class="memdesc:afc0c058ad3c8a4b5746d97c2f49b97a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">设置线程的CPU亲和性  <br /></td></tr>
<tr class="separator:afc0c058ad3c8a4b5746d97c2f49b97a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6d9ce836fd264a98548781886f375d2a" name="a6d9ce836fd264a98548781886f375d2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d9ce836fd264a98548781886f375d2a">&#9670;&#160;</a></span>sys_clone()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_clone </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>stack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>parent_tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>child_tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>tls</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>创建新线程（或进程） </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flags</td><td>克隆标志（CLONE_VM、CLONE_THREAD、CLONE_SIGHAND 等） </td></tr>
    <tr><td class="paramname">stack</td><td>新线程的栈指针（用户空间） </td></tr>
    <tr><td class="paramname">parent_tid</td><td>父线程TID存储地址（可选） </td></tr>
    <tr><td class="paramname">child_tid</td><td>子线程TID存储地址（可选） </td></tr>
    <tr><td class="paramname">tls</td><td>线程本地存储指针 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>成功返回新线程TID，失败返回负数 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：<ul>
<li>pthread_create 底层实现</li>
<li>fork() 实现（不带 CLONE_VM）</li>
<li><p class="startli">创建轻量级线程</p>
<p class="startli">flags 常用组合：</p><ul>
<li>CLONE_VM | CLONE_THREAD | CLONE_SIGHAND: 创建共享地址空间的线程</li>
<li>0: 创建独立进程（类似 fork） </li>
</ul>
</li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00087">87</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   88</span>                         {</div>
<div class="line"><span class="lineno">   89</span>  <span class="keyword">auto</span>&amp; task_manager = <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>();</div>
<div class="line"><span class="lineno">   90</span>  <span class="keyword">auto</span> current = task_manager.GetCurrentTask();</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>  <span class="keywordflow">if</span> (!current || !current-&gt;trap_context_ptr) {</div>
<div class="line"><span class="lineno">   93</span>    <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] sys_clone: Invalid current task or trap context\n&quot;</span>);</div>
<div class="line"><span class="lineno">   94</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">   95</span>  }</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>  <span class="comment">// 调用 TaskManager 的 Clone 方法</span></div>
<div class="line"><span class="lineno">   98</span>  <span class="keyword">auto</span> result = task_manager.Clone(<a class="code hl_variable" href="acpi_8h.html#a773b39d480759f67926cb18ae2219281">flags</a>, stack, parent_tid, child_tid, tls,</div>
<div class="line"><span class="lineno">   99</span>                                   *current-&gt;trap_context_ptr);</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>  <span class="keywordflow">if</span> (!result.has_value()) {</div>
<div class="line"><span class="lineno">  102</span>    <span class="comment">// 失败返回 -1</span></div>
<div class="line"><span class="lineno">  103</span>    <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] sys_clone failed: %s\n&quot;</span>, result.error().message());</div>
<div class="line"><span class="lineno">  104</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  105</span>  }</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>  <a class="code hl_typedef" href="task__control__block_8hpp.html#a7b3497faea769e764efc8647bc2103f1">Pid</a> child_pid = result.value();</div>
<div class="line"><span class="lineno">  108</span>  <span class="keywordflow">if</span> (child_pid == 0) {</div>
<div class="line"><span class="lineno">  109</span>    <span class="comment">// 子进程/线程返回 0</span></div>
<div class="line"><span class="lineno">  110</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  111</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  112</span>    <span class="comment">// 父进程返回子进程 PID</span></div>
<div class="line"><span class="lineno">  113</span>    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(child_pid);</div>
<div class="line"><span class="lineno">  114</span>  }</div>
<div class="line"><span class="lineno">  115</span>}</div>
<div class="ttc" id="aacpi_8h_html_a773b39d480759f67926cb18ae2219281"><div class="ttname"><a href="acpi_8h.html#a773b39d480759f67926cb18ae2219281">flags</a></div><div class="ttdeci">uint32_t flags</div><div class="ttdef"><b>Definition</b> <a href="acpi_8h_source.html#l00038">acpi.h:38</a></div></div>
<div class="ttc" id="aclassSingleton_html_a68856b49e098eadba37b60366db33ebd"><div class="ttname"><a href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton::GetInstance</a></div><div class="ttdeci">static auto GetInstance() -&gt; T &amp;</div><div class="ttdef"><b>Definition</b> <a href="singleton_8hpp_source.html#l00023">singleton.hpp:23</a></div></div>
<div class="ttc" id="astructklog_1_1Err_html"><div class="ttname"><a href="structklog_1_1Err.html">klog::Err</a></div><div class="ttdef"><b>Definition</b> <a href="kernel__log_8hpp_source.html#l00188">kernel_log.hpp:188</a></div></div>
<div class="ttc" id="atask__control__block_8hpp_html_a7b3497faea769e764efc8647bc2103f1"><div class="ttname"><a href="task__control__block_8hpp.html#a7b3497faea769e764efc8647bc2103f1">Pid</a></div><div class="ttdeci">size_t Pid</div><div class="ttdoc">进程 ID 类型</div><div class="ttdef"><b>Definition</b> <a href="task__control__block_8hpp_source.html#l00017">task_control_block.hpp:17</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a6d9ce836fd264a98548781886f375d2a_cgraph.png" border="0" usemap="#asyscall_8cpp_a6d9ce836fd264a98548781886f375d2a_cgraph" alt=""/></div>
<map name="asyscall_8cpp_a6d9ce836fd264a98548781886f375d2a_cgraph" id="asyscall_8cpp_a6d9ce836fd264a98548781886f375d2a_cgraph">
<area shape="rect" title="创建新线程（或进程）" alt="" coords="5,5,92,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="140,5,309,31"/>
<area shape="poly" title=" " alt="" coords="92,15,126,15,126,21,92,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a6d9ce836fd264a98548781886f375d2a_icgraph.png" border="0" usemap="#asyscall_8cpp_a6d9ce836fd264a98548781886f375d2a_icgraph" alt=""/></div>
<map name="asyscall_8cpp_a6d9ce836fd264a98548781886f375d2a_icgraph" id="asyscall_8cpp_a6d9ce836fd264a98548781886f375d2a_icgraph">
<area shape="rect" title="创建新线程（或进程）" alt="" coords="312,5,399,31"/>
<area shape="rect" href="syscall_8cpp.html#a9c01f57bb4ef6f1b91ccce212494a199" title=" " alt="" coords="121,5,264,31"/>
<area shape="poly" title=" " alt="" coords="298,21,264,21,264,15,298,15"/>
<area shape="rect" href="arch_2aarch64_2syscall_8cpp.html#a27f252437c17e7b5d2e8aef749daf1f0" title=" " alt="" coords="5,5,73,31"/>
<area shape="poly" title=" " alt="" coords="108,21,74,21,74,15,108,15"/>
</map>
</div>

</div>
</div>
<a id="a34c7946fbbdfb071d2b453a745dcb9b4" name="a34c7946fbbdfb071d2b453a745dcb9b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34c7946fbbdfb071d2b453a745dcb9b4">&#9670;&#160;</a></span>sys_exit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_exit </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>code</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>退出当前进程或线程 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">code</td><td>退出码 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>不返回 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：<ul>
<li>进程正常/异常终止</li>
<li><p class="startli">线程退出（clone 创建的线程调用时只退出当前线程）</p>
<p class="startli">行为取决于线程创建方式：</p><ul>
<li>普通进程：退出整个进程</li>
<li>CLONE_THREAD 线程：仅退出当前线程 </li>
</ul>
</li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00067">67</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   67</span>                       {</div>
<div class="line"><span class="lineno">   68</span>  <a class="code hl_struct" href="structklog_1_1Info.html">klog::Info</a>(<span class="stringliteral">&quot;[Syscall] Process %d exited with code %d\n&quot;</span>,</div>
<div class="line"><span class="lineno">   69</span>             <a class="code hl_class" href="classSingleton.html">Singleton&lt;TaskManager&gt;::GetInstance</a>().GetCurrentTask()-&gt;pid, code);</div>
<div class="line"><span class="lineno">   70</span>  <span class="comment">// 调用 TaskManager 的 Exit 方法处理线程退出</span></div>
<div class="line"><span class="lineno">   71</span>  <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>().Exit(code);</div>
<div class="line"><span class="lineno">   72</span>  <span class="comment">// 不会执行到这里，因为 Exit 会触发调度切换</span></div>
<div class="line"><span class="lineno">   73</span>  <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] sys_exit should not return!\n&quot;</span>);</div>
<div class="line"><span class="lineno">   74</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   75</span>}</div>
<div class="ttc" id="aclassSingleton_html"><div class="ttname"><a href="classSingleton.html">Singleton</a></div><div class="ttdef"><b>Definition</b> <a href="singleton_8hpp_source.html#l00010">singleton.hpp:10</a></div></div>
<div class="ttc" id="astructklog_1_1Info_html"><div class="ttname"><a href="structklog_1_1Info.html">klog::Info</a></div><div class="ttdef"><b>Definition</b> <a href="kernel__log_8hpp_source.html#l00168">kernel_log.hpp:168</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a34c7946fbbdfb071d2b453a745dcb9b4_cgraph.png" border="0" usemap="#asyscall_8cpp_a34c7946fbbdfb071d2b453a745dcb9b4_cgraph" alt=""/></div>
<map name="asyscall_8cpp_a34c7946fbbdfb071d2b453a745dcb9b4_cgraph" id="asyscall_8cpp_a34c7946fbbdfb071d2b453a745dcb9b4_cgraph">
<area shape="rect" title="退出当前进程或线程" alt="" coords="5,5,81,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="129,5,299,31"/>
<area shape="poly" title=" " alt="" coords="82,15,115,15,115,21,82,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a34c7946fbbdfb071d2b453a745dcb9b4_icgraph.png" border="0" usemap="#asyscall_8cpp_a34c7946fbbdfb071d2b453a745dcb9b4_icgraph" alt=""/></div>
<map name="asyscall_8cpp_a34c7946fbbdfb071d2b453a745dcb9b4_icgraph" id="asyscall_8cpp_a34c7946fbbdfb071d2b453a745dcb9b4_icgraph">
<area shape="rect" title="退出当前进程或线程" alt="" coords="312,5,388,31"/>
<area shape="rect" href="syscall_8cpp.html#a9c01f57bb4ef6f1b91ccce212494a199" title=" " alt="" coords="121,5,264,31"/>
<area shape="poly" title=" " alt="" coords="298,21,264,21,264,15,298,15"/>
<area shape="rect" href="arch_2aarch64_2syscall_8cpp.html#a27f252437c17e7b5d2e8aef749daf1f0" title=" " alt="" coords="5,5,73,31"/>
<area shape="poly" title=" " alt="" coords="108,21,74,21,74,15,108,15"/>
</map>
</div>

</div>
</div>
<a id="a01fbd4b45143dd51bf6f338d8ee325da" name="a01fbd4b45143dd51bf6f338d8ee325da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01fbd4b45143dd51bf6f338d8ee325da">&#9670;&#160;</a></span>sys_fork()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_fork </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>创建新进程（fork） </p>
<dl class="section return"><dt>Returns</dt><dd>父进程返回子进程 PID，子进程返回 0，失败返回 -1 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：<ul>
<li>进程创建</li>
<li><p class="startli">完全复制父进程的地址空间和资源</p>
<p class="startli">fork 创建的子进程：</p><ul>
<li>拥有独立的地址空间（页表被复制）</li>
<li>拥有独立的进程 ID (PID)</li>
<li>继承父进程的文件描述符、信号处理器等</li>
<li>父子进程独立运行，互不影响 </li>
</ul>
</li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00117">117</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  117</span>               {</div>
<div class="line"><span class="lineno">  118</span>  <span class="keyword">auto</span>&amp; task_manager = <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>();</div>
<div class="line"><span class="lineno">  119</span>  <span class="keyword">auto</span> current = task_manager.GetCurrentTask();</div>
<div class="line"><span class="lineno">  120</span> </div>
<div class="line"><span class="lineno">  121</span>  <span class="keywordflow">if</span> (!current || !current-&gt;trap_context_ptr) {</div>
<div class="line"><span class="lineno">  122</span>    <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] sys_fork: Invalid current task or trap context\n&quot;</span>);</div>
<div class="line"><span class="lineno">  123</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  124</span>  }</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>  <span class="comment">// fork = clone with flags=0 (完全复制，不共享任何资源)</span></div>
<div class="line"><span class="lineno">  127</span>  <span class="keyword">auto</span> result = task_manager.Clone(0, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>,</div>
<div class="line"><span class="lineno">  128</span>                                   *current-&gt;trap_context_ptr);</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>  <span class="keywordflow">if</span> (!result.has_value()) {</div>
<div class="line"><span class="lineno">  131</span>    <span class="comment">// 失败返回 -1</span></div>
<div class="line"><span class="lineno">  132</span>    <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] sys_fork failed: %s\n&quot;</span>, result.error().message());</div>
<div class="line"><span class="lineno">  133</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  134</span>  }</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>  <a class="code hl_typedef" href="task__control__block_8hpp.html#a7b3497faea769e764efc8647bc2103f1">Pid</a> child_pid = result.value();</div>
<div class="line"><span class="lineno">  137</span>  <span class="keywordflow">if</span> (child_pid == 0) {</div>
<div class="line"><span class="lineno">  138</span>    <span class="comment">// 子进程返回 0</span></div>
<div class="line"><span class="lineno">  139</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  140</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  141</span>    <span class="comment">// 父进程返回子进程 PID</span></div>
<div class="line"><span class="lineno">  142</span>    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(child_pid);</div>
<div class="line"><span class="lineno">  143</span>  }</div>
<div class="line"><span class="lineno">  144</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a01fbd4b45143dd51bf6f338d8ee325da_cgraph.png" border="0" usemap="#asyscall_8cpp_a01fbd4b45143dd51bf6f338d8ee325da_cgraph" alt=""/></div>
<map name="asyscall_8cpp_a01fbd4b45143dd51bf6f338d8ee325da_cgraph" id="asyscall_8cpp_a01fbd4b45143dd51bf6f338d8ee325da_cgraph">
<area shape="rect" title="创建新进程（fork）" alt="" coords="5,5,83,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="131,5,300,31"/>
<area shape="poly" title=" " alt="" coords="83,15,117,15,117,21,83,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a01fbd4b45143dd51bf6f338d8ee325da_icgraph.png" border="0" usemap="#asyscall_8cpp_a01fbd4b45143dd51bf6f338d8ee325da_icgraph" alt=""/></div>
<map name="asyscall_8cpp_a01fbd4b45143dd51bf6f338d8ee325da_icgraph" id="asyscall_8cpp_a01fbd4b45143dd51bf6f338d8ee325da_icgraph">
<area shape="rect" title="创建新进程（fork）" alt="" coords="312,5,389,31"/>
<area shape="rect" href="syscall_8cpp.html#a9c01f57bb4ef6f1b91ccce212494a199" title=" " alt="" coords="121,5,264,31"/>
<area shape="poly" title=" " alt="" coords="298,21,264,21,264,15,298,15"/>
<area shape="rect" href="arch_2aarch64_2syscall_8cpp.html#a27f252437c17e7b5d2e8aef749daf1f0" title=" " alt="" coords="5,5,73,31"/>
<area shape="poly" title=" " alt="" coords="108,21,74,21,74,15,108,15"/>
</map>
</div>

</div>
</div>
<a id="aa03f906affa67ef23ebfbcb79efa569f" name="aa03f906affa67ef23ebfbcb79efa569f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa03f906affa67ef23ebfbcb79efa569f">&#9670;&#160;</a></span>sys_futex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_futex </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>uaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>uaddr2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>val3</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>快速用户空间互斥锁操作（futex） </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">uaddr</td><td>用户空间的futex地址 </td></tr>
    <tr><td class="paramname">op</td><td>操作类型（FUTEX_WAIT、FUTEX_WAKE 等） </td></tr>
    <tr><td class="paramname">val</td><td>操作参数 </td></tr>
    <tr><td class="paramname">timeout</td><td>超时时间（可选） </td></tr>
    <tr><td class="paramname">uaddr2</td><td>第二个futex地址（部分操作使用） </td></tr>
    <tr><td class="paramname">val3</td><td>第三个参数（部分操作使用） </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>依操作类型而定，失败返回负数 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：<ul>
<li>实现互斥锁（mutex）</li>
<li>实现条件变量（condition variable）</li>
<li>实现读写锁（rwlock）</li>
<li>实现信号量（semaphore）</li>
<li>实现 pthread_join（等待线程退出）</li>
<li><p class="startli">实现 pthread_detach（线程状态管理）</p>
<p class="startli">常用操作：</p><ul>
<li>FUTEX_WAIT: 等待futex值变化</li>
<li>FUTEX_WAKE: 唤醒等待的线程</li>
<li>FUTEX_REQUEUE: 重新排队等待的线程 </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000013">Todo:</a></b></dt><dd>需要实现原子比较和阻塞逻辑 </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000014">Todo:</a></b></dt><dd></dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000015">Todo:</a></b></dt><dd>需要在 <a class="el" href="classTaskManager.html" title="任务管理器">TaskManager</a> 中添加 futex 等待队列 </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000016">Todo:</a></b></dt><dd>应该返回实际唤醒的线程数 </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000017">Todo:</a></b></dt><dd>实现 FUTEX_REQUEUE </dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00170">170</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  171</span>                                                                       {</div>
<div class="line"><span class="lineno">  172</span>  <span class="comment">// Futex 常量定义</span></div>
<div class="line"><span class="lineno">  173</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> FUTEX_WAIT = 0;</div>
<div class="line"><span class="lineno">  174</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> FUTEX_WAKE = 1;</div>
<div class="line"><span class="lineno">  175</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> FUTEX_REQUEUE = 3;</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>  <span class="comment">// 提取操作类型（低位）</span></div>
<div class="line"><span class="lineno">  178</span>  <span class="keywordtype">int</span> cmd = op &amp; 0x7F;</div>
<div class="line"><span class="lineno">  179</span> </div>
<div class="line"><span class="lineno">  180</span>  <span class="keyword">auto</span>&amp; task_manager = <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>();</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>  <span class="keywordflow">switch</span> (cmd) {</div>
<div class="line"><span class="lineno">  183</span>    <span class="keywordflow">case</span> FUTEX_WAIT: {</div>
<div class="line"><span class="lineno">  184</span>      <span class="comment">// 检查 *uaddr 是否等于 val，如果相等则阻塞</span></div>
<div class="line"><span class="lineno">  187</span>      <a class="code hl_struct" href="structklog_1_1Debug.html">klog::Debug</a>(<span class="stringliteral">&quot;[Syscall] FUTEX_WAIT on %p (val=%d)\n&quot;</span>, uaddr, val);</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>      <span class="comment">// 简化实现：直接检查值并阻塞</span></div>
<div class="line"><span class="lineno">  190</span>      <span class="keywordflow">if</span> (*uaddr == val) {</div>
<div class="line"><span class="lineno">  191</span>        <span class="comment">// 使用 Futex 类型的资源 ID，地址作为标识</span></div>
<div class="line"><span class="lineno">  192</span>        <a class="code hl_struct" href="structResourceId.html">ResourceId</a> futex_id(<a class="code hl_enumvalue" href="resource__id_8hpp.html#aeea667e01168927f6d83af2e203019bca1a69927dc0a295f27b6ce7e7fc9be66c">ResourceType::kFutex</a>,</div>
<div class="line"><span class="lineno">  193</span>                            <span class="keyword">reinterpret_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(uaddr));</div>
<div class="line"><span class="lineno">  194</span>        task_manager.Block(futex_id);</div>
<div class="line"><span class="lineno">  195</span>      }</div>
<div class="line"><span class="lineno">  196</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  197</span>    }</div>
<div class="line"><span class="lineno">  198</span> </div>
<div class="line"><span class="lineno">  199</span>    <span class="keywordflow">case</span> FUTEX_WAKE: {</div>
<div class="line"><span class="lineno">  200</span>      <span class="comment">// 唤醒最多 val 个等待 uaddr 的线程</span></div>
<div class="line"><span class="lineno">  201</span>      <a class="code hl_struct" href="structklog_1_1Debug.html">klog::Debug</a>(<span class="stringliteral">&quot;[Syscall] FUTEX_WAKE on %p (count=%d)\n&quot;</span>, uaddr, val);</div>
<div class="line"><span class="lineno">  202</span> </div>
<div class="line"><span class="lineno">  203</span>      <span class="comment">// 唤醒等待该 futex 的所有线程（简化实现，应该只唤醒 val 个）</span></div>
<div class="line"><span class="lineno">  204</span>      <a class="code hl_struct" href="structResourceId.html">ResourceId</a> futex_id(<a class="code hl_enumvalue" href="resource__id_8hpp.html#aeea667e01168927f6d83af2e203019bca1a69927dc0a295f27b6ce7e7fc9be66c">ResourceType::kFutex</a>,</div>
<div class="line"><span class="lineno">  205</span>                          <span class="keyword">reinterpret_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(uaddr));</div>
<div class="line"><span class="lineno">  206</span>      task_manager.Wakeup(futex_id);</div>
<div class="line"><span class="lineno">  207</span> </div>
<div class="line"><span class="lineno">  209</span>      <span class="keywordflow">return</span> val;</div>
<div class="line"><span class="lineno">  210</span>    }</div>
<div class="line"><span class="lineno">  211</span> </div>
<div class="line"><span class="lineno">  212</span>    <span class="keywordflow">case</span> FUTEX_REQUEUE: {</div>
<div class="line"><span class="lineno">  213</span>      <span class="comment">// 将等待 uaddr 的线程重新排队到 uaddr2</span></div>
<div class="line"><span class="lineno">  215</span>      <a class="code hl_struct" href="structklog_1_1Warn.html">klog::Warn</a>(<span class="stringliteral">&quot;[Syscall] FUTEX_REQUEUE not implemented\n&quot;</span>);</div>
<div class="line"><span class="lineno">  216</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  217</span>    }</div>
<div class="line"><span class="lineno">  218</span> </div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  220</span>      <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] Unknown futex operation: %d\n&quot;</span>, cmd);</div>
<div class="line"><span class="lineno">  221</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  222</span>  }</div>
<div class="line"><span class="lineno">  223</span>}</div>
<div class="ttc" id="aresource__id_8hpp_html_aeea667e01168927f6d83af2e203019bca1a69927dc0a295f27b6ce7e7fc9be66c"><div class="ttname"><a href="resource__id_8hpp.html#aeea667e01168927f6d83af2e203019bca1a69927dc0a295f27b6ce7e7fc9be66c">ResourceType::kFutex</a></div><div class="ttdeci">@ kFutex</div></div>
<div class="ttc" id="astructResourceId_html"><div class="ttname"><a href="structResourceId.html">ResourceId</a></div><div class="ttdoc">资源 ID</div><div class="ttdef"><b>Definition</b> <a href="resource__id_8hpp_source.html#l00075">resource_id.hpp:75</a></div></div>
<div class="ttc" id="astructklog_1_1Debug_html"><div class="ttname"><a href="structklog_1_1Debug.html">klog::Debug</a></div><div class="ttdef"><b>Definition</b> <a href="kernel__log_8hpp_source.html#l00146">kernel_log.hpp:146</a></div></div>
<div class="ttc" id="astructklog_1_1Warn_html"><div class="ttname"><a href="structklog_1_1Warn.html">klog::Warn</a></div><div class="ttdef"><b>Definition</b> <a href="kernel__log_8hpp_source.html#l00178">kernel_log.hpp:178</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_aa03f906affa67ef23ebfbcb79efa569f_cgraph.png" border="0" usemap="#asyscall_8cpp_aa03f906affa67ef23ebfbcb79efa569f_cgraph" alt=""/></div>
<map name="asyscall_8cpp_aa03f906affa67ef23ebfbcb79efa569f_cgraph" id="asyscall_8cpp_aa03f906affa67ef23ebfbcb79efa569f_cgraph">
<area shape="rect" title="快速用户空间互斥锁操作（futex）" alt="" coords="5,5,91,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="139,5,308,31"/>
<area shape="poly" title=" " alt="" coords="91,15,125,15,125,21,91,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_aa03f906affa67ef23ebfbcb79efa569f_icgraph.png" border="0" usemap="#asyscall_8cpp_aa03f906affa67ef23ebfbcb79efa569f_icgraph" alt=""/></div>
<map name="asyscall_8cpp_aa03f906affa67ef23ebfbcb79efa569f_icgraph" id="asyscall_8cpp_aa03f906affa67ef23ebfbcb79efa569f_icgraph">
<area shape="rect" title="快速用户空间互斥锁操作（futex）" alt="" coords="312,5,397,31"/>
<area shape="rect" href="syscall_8cpp.html#a9c01f57bb4ef6f1b91ccce212494a199" title=" " alt="" coords="121,5,264,31"/>
<area shape="poly" title=" " alt="" coords="298,21,264,21,264,15,298,15"/>
<area shape="rect" href="arch_2aarch64_2syscall_8cpp.html#a27f252437c17e7b5d2e8aef749daf1f0" title=" " alt="" coords="5,5,73,31"/>
<area shape="poly" title=" " alt="" coords="108,21,74,21,74,15,108,15"/>
</map>
</div>

</div>
</div>
<a id="a17717d9e7bc25b272fe4dbb63bc52baa" name="a17717d9e7bc25b272fe4dbb63bc52baa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17717d9e7bc25b272fe4dbb63bc52baa">&#9670;&#160;</a></span>sys_gettid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_gettid </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>获取当前线程ID </p>
<dl class="section return"><dt>Returns</dt><dd>当前线程的TID </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：<ul>
<li>线程标识</li>
<li>调试信息输出</li>
<li>线程本地数据索引 </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00146">146</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  146</span>                 {</div>
<div class="line"><span class="lineno">  147</span>  <span class="keyword">auto</span> current = <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>().GetCurrentTask();</div>
<div class="line"><span class="lineno">  148</span>  <span class="keywordflow">if</span> (!current) {</div>
<div class="line"><span class="lineno">  149</span>    <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] sys_gettid: No current task\n&quot;</span>);</div>
<div class="line"><span class="lineno">  150</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  151</span>  }</div>
<div class="line"><span class="lineno">  152</span>  <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(current-&gt;pid);</div>
<div class="line"><span class="lineno">  153</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a17717d9e7bc25b272fe4dbb63bc52baa_cgraph.png" border="0" usemap="#asyscall_8cpp_a17717d9e7bc25b272fe4dbb63bc52baa_cgraph" alt=""/></div>
<map name="asyscall_8cpp_a17717d9e7bc25b272fe4dbb63bc52baa_cgraph" id="asyscall_8cpp_a17717d9e7bc25b272fe4dbb63bc52baa_cgraph">
<area shape="rect" title="获取当前线程ID" alt="" coords="5,5,95,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="143,5,312,31"/>
<area shape="poly" title=" " alt="" coords="95,15,129,15,129,21,95,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a17717d9e7bc25b272fe4dbb63bc52baa_icgraph.png" border="0" usemap="#asyscall_8cpp_a17717d9e7bc25b272fe4dbb63bc52baa_icgraph" alt=""/></div>
<map name="asyscall_8cpp_a17717d9e7bc25b272fe4dbb63bc52baa_icgraph" id="asyscall_8cpp_a17717d9e7bc25b272fe4dbb63bc52baa_icgraph">
<area shape="rect" title="获取当前线程ID" alt="" coords="312,5,401,31"/>
<area shape="rect" href="syscall_8cpp.html#a9c01f57bb4ef6f1b91ccce212494a199" title=" " alt="" coords="121,5,264,31"/>
<area shape="poly" title=" " alt="" coords="298,21,264,21,264,15,298,15"/>
<area shape="rect" href="arch_2aarch64_2syscall_8cpp.html#a27f252437c17e7b5d2e8aef749daf1f0" title=" " alt="" coords="5,5,73,31"/>
<area shape="poly" title=" " alt="" coords="108,21,74,21,74,15,108,15"/>
</map>
</div>

</div>
</div>
<a id="a4dd37ef811b362b4638eb21fab7f09fc" name="a4dd37ef811b362b4638eb21fab7f09fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dd37ef811b362b4638eb21fab7f09fc">&#9670;&#160;</a></span>sys_sched_getaffinity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_sched_getaffinity </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cpusetsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>获取线程的CPU亲和性 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pid</td><td>线程ID（0 表示当前线程） </td></tr>
    <tr><td class="paramname">cpusetsize</td><td>CPU集合大小 </td></tr>
    <tr><td class="paramname">mask</td><td>CPU亲和性掩码 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>成功返回 0，失败返回负数 </dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00225">225</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  225</span>                                                                      {</div>
<div class="line"><span class="lineno">  226</span>  <span class="keyword">auto</span>&amp; task_manager = <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>();</div>
<div class="line"><span class="lineno">  227</span> </div>
<div class="line"><span class="lineno">  228</span>  <a class="code hl_struct" href="structTaskControlBlock.html">TaskControlBlock</a>* target;</div>
<div class="line"><span class="lineno">  229</span>  <span class="keywordflow">if</span> (pid == 0) {</div>
<div class="line"><span class="lineno">  230</span>    <span class="comment">// pid=0 表示当前线程</span></div>
<div class="line"><span class="lineno">  231</span>    target = task_manager.GetCurrentTask();</div>
<div class="line"><span class="lineno">  232</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  233</span>    <span class="comment">// 查找指定 PID 的任务</span></div>
<div class="line"><span class="lineno">  234</span>    target = task_manager.FindTask(<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="task__control__block_8hpp.html#a7b3497faea769e764efc8647bc2103f1">Pid</a><span class="keyword">&gt;</span>(pid));</div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">if</span> (!target) {</div>
<div class="line"><span class="lineno">  236</span>      <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] sys_sched_getaffinity: Task %d not found\n&quot;</span>, pid);</div>
<div class="line"><span class="lineno">  237</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  238</span>    }</div>
<div class="line"><span class="lineno">  239</span>  }</div>
<div class="line"><span class="lineno">  240</span> </div>
<div class="line"><span class="lineno">  241</span>  <span class="keywordflow">if</span> (!target) {</div>
<div class="line"><span class="lineno">  242</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  243</span>  }</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>  <span class="comment">// 简单实现：将 cpu_affinity 复制到用户空间</span></div>
<div class="line"><span class="lineno">  246</span>  <span class="keywordflow">if</span> (cpusetsize &lt; <span class="keyword">sizeof</span>(uint64_t)) {</div>
<div class="line"><span class="lineno">  247</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  248</span>  }</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>  *mask = target-&gt;<a class="code hl_variable" href="structTaskControlBlock.html#a82296b6fec3ae8a120ffec4f0e97ef81">cpu_affinity</a>;</div>
<div class="line"><span class="lineno">  251</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  252</span>}</div>
<div class="ttc" id="astructTaskControlBlock_html"><div class="ttname"><a href="structTaskControlBlock.html">TaskControlBlock</a></div><div class="ttdoc">任务控制块，管理进程/线程的核心数据结构</div><div class="ttdef"><b>Definition</b> <a href="task__control__block_8hpp_source.html#l00080">task_control_block.hpp:80</a></div></div>
<div class="ttc" id="astructTaskControlBlock_html_a82296b6fec3ae8a120ffec4f0e97ef81"><div class="ttname"><a href="structTaskControlBlock.html#a82296b6fec3ae8a120ffec4f0e97ef81">TaskControlBlock::cpu_affinity</a></div><div class="ttdeci">uint64_t cpu_affinity</div><div class="ttdoc">CPU 亲和性位掩码</div><div class="ttdef"><b>Definition</b> <a href="task__control__block_8hpp_source.html#l00181">task_control_block.hpp:181</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a4dd37ef811b362b4638eb21fab7f09fc_cgraph.png" border="0" usemap="#asyscall_8cpp_a4dd37ef811b362b4638eb21fab7f09fc_cgraph" alt=""/></div>
<map name="asyscall_8cpp_a4dd37ef811b362b4638eb21fab7f09fc_cgraph" id="asyscall_8cpp_a4dd37ef811b362b4638eb21fab7f09fc_cgraph">
<area shape="rect" title="获取线程的CPU亲和性" alt="" coords="5,5,168,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="216,5,385,31"/>
<area shape="poly" title=" " alt="" coords="168,15,202,15,202,21,168,21"/>
</map>
</div>

</div>
</div>
<a id="afc0c058ad3c8a4b5746d97c2f49b97a4" name="afc0c058ad3c8a4b5746d97c2f49b97a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc0c058ad3c8a4b5746d97c2f49b97a4">&#9670;&#160;</a></span>sys_sched_setaffinity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_sched_setaffinity </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cpusetsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint64_t *&#160;</td>
          <td class="paramname"><em>mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>设置线程的CPU亲和性 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pid</td><td>线程ID（0 表示当前线程） </td></tr>
    <tr><td class="paramname">cpusetsize</td><td>CPU集合大小 </td></tr>
    <tr><td class="paramname">mask</td><td>CPU亲和性掩码 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>成功返回 0，失败返回负数 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：<ul>
<li>CPU绑定优化</li>
<li>实时任务调度</li>
<li>NUMA优化 </li>
</ul>
</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000018">Todo:</a></b></dt><dd>如果当前任务不在允许的 CPU 上运行，应该触发迁移 </dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00254">254</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  254</span>                                                                            {</div>
<div class="line"><span class="lineno">  255</span>  <span class="keyword">auto</span>&amp; task_manager = <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>();</div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>  <a class="code hl_struct" href="structTaskControlBlock.html">TaskControlBlock</a>* target;</div>
<div class="line"><span class="lineno">  258</span>  <span class="keywordflow">if</span> (pid == 0) {</div>
<div class="line"><span class="lineno">  259</span>    target = task_manager.GetCurrentTask();</div>
<div class="line"><span class="lineno">  260</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  261</span>    <span class="comment">// 查找指定 PID 的任务</span></div>
<div class="line"><span class="lineno">  262</span>    target = task_manager.FindTask(<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="task__control__block_8hpp.html#a7b3497faea769e764efc8647bc2103f1">Pid</a><span class="keyword">&gt;</span>(pid));</div>
<div class="line"><span class="lineno">  263</span>    <span class="keywordflow">if</span> (!target) {</div>
<div class="line"><span class="lineno">  264</span>      <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] sys_sched_setaffinity: Task %d not found\n&quot;</span>, pid);</div>
<div class="line"><span class="lineno">  265</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  266</span>    }</div>
<div class="line"><span class="lineno">  267</span>  }</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>  <span class="keywordflow">if</span> (!target) {</div>
<div class="line"><span class="lineno">  270</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  271</span>  }</div>
<div class="line"><span class="lineno">  272</span> </div>
<div class="line"><span class="lineno">  273</span>  <span class="comment">// 简单实现：更新 cpu_affinity</span></div>
<div class="line"><span class="lineno">  274</span>  <span class="keywordflow">if</span> (cpusetsize &lt; <span class="keyword">sizeof</span>(uint64_t)) {</div>
<div class="line"><span class="lineno">  275</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  276</span>  }</div>
<div class="line"><span class="lineno">  277</span> </div>
<div class="line"><span class="lineno">  278</span>  target-&gt;<a class="code hl_variable" href="structTaskControlBlock.html#a82296b6fec3ae8a120ffec4f0e97ef81">cpu_affinity</a> = *mask;</div>
<div class="line"><span class="lineno">  279</span> </div>
<div class="line"><span class="lineno">  280</span>  <a class="code hl_struct" href="structklog_1_1Debug.html">klog::Debug</a>(<span class="stringliteral">&quot;[Syscall] Set CPU affinity for task %zu to 0x%lx\n&quot;</span>, target-&gt;<a class="code hl_variable" href="structTaskControlBlock.html#aca9ca152ecda65751f10c515c4dbb867">pid</a>,</div>
<div class="line"><span class="lineno">  281</span>              *mask);</div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  286</span>}</div>
<div class="ttc" id="astructTaskControlBlock_html_aca9ca152ecda65751f10c515c4dbb867"><div class="ttname"><a href="structTaskControlBlock.html#aca9ca152ecda65751f10c515c4dbb867">TaskControlBlock::pid</a></div><div class="ttdeci">Pid pid</div><div class="ttdoc">线程 ID (Task ID)</div><div class="ttdef"><b>Definition</b> <a href="task__control__block_8hpp_source.html#l00102">task_control_block.hpp:102</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_afc0c058ad3c8a4b5746d97c2f49b97a4_cgraph.png" border="0" usemap="#asyscall_8cpp_afc0c058ad3c8a4b5746d97c2f49b97a4_cgraph" alt=""/></div>
<map name="asyscall_8cpp_afc0c058ad3c8a4b5746d97c2f49b97a4_cgraph" id="asyscall_8cpp_afc0c058ad3c8a4b5746d97c2f49b97a4_cgraph">
<area shape="rect" title="设置线程的CPU亲和性" alt="" coords="5,5,168,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="216,5,385,31"/>
<area shape="poly" title=" " alt="" coords="168,15,202,15,202,21,168,21"/>
</map>
</div>

</div>
</div>
<a id="ab5c00759c95d8ce9e9db75b1b55a9552" name="ab5c00759c95d8ce9e9db75b1b55a9552"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5c00759c95d8ce9e9db75b1b55a9552">&#9670;&#160;</a></span>sys_set_tid_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_set_tid_address </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>tidptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>设置线程ID地址（用于线程退出时的清理） </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tidptr</td><td>线程ID存储地址 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>成功返回0，失败返回负数 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：<ul>
<li>线程库内部使用</li>
<li>实现线程退出时的通知机制 </li>
</ul>
</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000012">Todo:</a></b></dt><dd>需要在 <a class="el" href="structTaskControlBlock.html" title="任务控制块，管理进程/线程的核心数据结构">TaskControlBlock</a> 中添加字段保存 tidptr </dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00155">155</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  155</span>                                                      {</div>
<div class="line"><span class="lineno">  156</span>  <span class="keyword">auto</span> current = <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>().GetCurrentTask();</div>
<div class="line"><span class="lineno">  157</span>  <span class="keywordflow">if</span> (!current) {</div>
<div class="line"><span class="lineno">  158</span>    <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] sys_set_tid_address: No current task\n&quot;</span>);</div>
<div class="line"><span class="lineno">  159</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  160</span>  }</div>
<div class="line"><span class="lineno">  161</span> </div>
<div class="line"><span class="lineno">  162</span>  <span class="comment">// 保存 tidptr，在线程退出时会清零该地址并执行 futex wake</span></div>
<div class="line"><span class="lineno">  164</span>  <span class="comment">// current-&gt;clear_child_tid = tidptr;</span></div>
<div class="line"><span class="lineno">  165</span> </div>
<div class="line"><span class="lineno">  166</span>  <span class="comment">// 返回当前线程的 TID</span></div>
<div class="line"><span class="lineno">  167</span>  <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(current-&gt;pid);</div>
<div class="line"><span class="lineno">  168</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_ab5c00759c95d8ce9e9db75b1b55a9552_cgraph.png" border="0" usemap="#asyscall_8cpp_ab5c00759c95d8ce9e9db75b1b55a9552_cgraph" alt=""/></div>
<map name="asyscall_8cpp_ab5c00759c95d8ce9e9db75b1b55a9552_cgraph" id="asyscall_8cpp_ab5c00759c95d8ce9e9db75b1b55a9552_cgraph">
<area shape="rect" title="设置线程ID地址（用于线程退出时的清理）" alt="" coords="5,5,159,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="207,5,376,31"/>
<area shape="poly" title=" " alt="" coords="159,15,193,15,193,21,159,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_ab5c00759c95d8ce9e9db75b1b55a9552_icgraph.png" border="0" usemap="#asyscall_8cpp_ab5c00759c95d8ce9e9db75b1b55a9552_icgraph" alt=""/></div>
<map name="asyscall_8cpp_ab5c00759c95d8ce9e9db75b1b55a9552_icgraph" id="asyscall_8cpp_ab5c00759c95d8ce9e9db75b1b55a9552_icgraph">
<area shape="rect" title="设置线程ID地址（用于线程退出时的清理）" alt="" coords="312,5,465,31"/>
<area shape="rect" href="syscall_8cpp.html#a9c01f57bb4ef6f1b91ccce212494a199" title=" " alt="" coords="121,5,264,31"/>
<area shape="poly" title=" " alt="" coords="298,21,265,21,265,15,298,15"/>
<area shape="rect" href="arch_2aarch64_2syscall_8cpp.html#a27f252437c17e7b5d2e8aef749daf1f0" title=" " alt="" coords="5,5,73,31"/>
<area shape="poly" title=" " alt="" coords="108,21,74,21,74,15,108,15"/>
</map>
</div>

</div>
</div>
<a id="a83d46a7afcd47f11ed83ae871d058d20" name="a83d46a7afcd47f11ed83ae871d058d20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83d46a7afcd47f11ed83ae871d058d20">&#9670;&#160;</a></span>sys_sleep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_sleep </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>ms</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>休眠指定毫秒数 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ms</td><td>休眠时长（毫秒） </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 表示成功 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：定时任务、延迟执行 </dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00082">82</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   82</span>                           {</div>
<div class="line"><span class="lineno">   83</span>  <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>().Sleep(ms);</div>
<div class="line"><span class="lineno">   84</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   85</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a83d46a7afcd47f11ed83ae871d058d20_cgraph.png" border="0" usemap="#asyscall_8cpp_a83d46a7afcd47f11ed83ae871d058d20_cgraph" alt=""/></div>
<map name="asyscall_8cpp_a83d46a7afcd47f11ed83ae871d058d20_cgraph" id="asyscall_8cpp_a83d46a7afcd47f11ed83ae871d058d20_cgraph">
<area shape="rect" title="休眠指定毫秒数" alt="" coords="5,5,92,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="140,5,309,31"/>
<area shape="poly" title=" " alt="" coords="92,15,126,15,126,21,92,21"/>
</map>
</div>

</div>
</div>
<a id="a4fa66935c10e294006b6310af1c68f37" name="a4fa66935c10e294006b6310af1c68f37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fa66935c10e294006b6310af1c68f37">&#9670;&#160;</a></span>sys_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_write </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>向文件描述符写入数据 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>文件描述符 </td></tr>
    <tr><td class="paramname">buf</td><td>数据缓冲区 </td></tr>
    <tr><td class="paramname">len</td><td>数据长度 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>成功写入的字节数，失败返回负数 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：标准输出、日志输出等 </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000011">Todo:</a></b></dt><dd>应该检查 buf 是否在用户空间合法范围内 </dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00054">54</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   54</span>                                                   {</div>
<div class="line"><span class="lineno">   55</span>  <span class="comment">// 简单实现：仅支持向标准输出(1)和错误输出(2)打印</span></div>
<div class="line"><span class="lineno">   56</span>  <span class="keywordflow">if</span> (fd == 1 || fd == 2) {</div>
<div class="line"><span class="lineno">   58</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; len; ++i) {</div>
<div class="line"><span class="lineno">   59</span>      <span class="comment">// 使用 klog::Print 而不是 Format，避免 buffer 解析带来的问题</span></div>
<div class="line"><span class="lineno">   60</span>      <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;%c&quot;</span>, buf[i]);</div>
<div class="line"><span class="lineno">   61</span>    }</div>
<div class="line"><span class="lineno">   62</span>    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(len);</div>
<div class="line"><span class="lineno">   63</span>  }</div>
<div class="line"><span class="lineno">   64</span>  <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">   65</span>}</div>
<div class="ttc" id="ask__stdio_8h_html_ad8142b94111a30f723c6c0a2301bae7f"><div class="ttname"><a href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a></div><div class="ttdeci">int sk_printf(const char *format,...) __attribute__((format(printf</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a4fa66935c10e294006b6310af1c68f37_cgraph.png" border="0" usemap="#asyscall_8cpp_a4fa66935c10e294006b6310af1c68f37_cgraph" alt=""/></div>
<map name="asyscall_8cpp_a4fa66935c10e294006b6310af1c68f37_cgraph" id="asyscall_8cpp_a4fa66935c10e294006b6310af1c68f37_cgraph">
<area shape="rect" title="向文件描述符写入数据" alt="" coords="5,5,89,31"/>
<area shape="rect" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f" title=" " alt="" coords="137,5,216,31"/>
<area shape="poly" title=" " alt="" coords="89,15,124,15,124,21,89,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a4fa66935c10e294006b6310af1c68f37_icgraph.png" border="0" usemap="#asyscall_8cpp_a4fa66935c10e294006b6310af1c68f37_icgraph" alt=""/></div>
<map name="asyscall_8cpp_a4fa66935c10e294006b6310af1c68f37_icgraph" id="asyscall_8cpp_a4fa66935c10e294006b6310af1c68f37_icgraph">
<area shape="rect" title="向文件描述符写入数据" alt="" coords="312,5,396,31"/>
<area shape="rect" href="syscall_8cpp.html#a9c01f57bb4ef6f1b91ccce212494a199" title=" " alt="" coords="121,5,264,31"/>
<area shape="poly" title=" " alt="" coords="298,21,264,21,264,15,298,15"/>
<area shape="rect" href="arch_2aarch64_2syscall_8cpp.html#a27f252437c17e7b5d2e8aef749daf1f0" title=" " alt="" coords="5,5,73,31"/>
<area shape="poly" title=" " alt="" coords="108,21,74,21,74,15,108,15"/>
</map>
</div>

</div>
</div>
<a id="a23ac80734740f098e56332da33758ace" name="a23ac80734740f098e56332da33758ace"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23ac80734740f098e56332da33758ace">&#9670;&#160;</a></span>sys_yield()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_yield </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>主动放弃CPU，让出时间片 </p>
<dl class="section return"><dt>Returns</dt><dd>0 表示成功 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>使用场景：协作式调度、忙等待优化 </dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00077">77</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   77</span>                {</div>
<div class="line"><span class="lineno">   78</span>  <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;TaskManager&gt;::GetInstance</a>().Schedule();</div>
<div class="line"><span class="lineno">   79</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   80</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a23ac80734740f098e56332da33758ace_cgraph.png" border="0" usemap="#asyscall_8cpp_a23ac80734740f098e56332da33758ace_cgraph" alt=""/></div>
<map name="asyscall_8cpp_a23ac80734740f098e56332da33758ace_cgraph" id="asyscall_8cpp_a23ac80734740f098e56332da33758ace_cgraph">
<area shape="rect" title="主动放弃CPU，让出时间片" alt="" coords="5,5,88,31"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="136,5,305,31"/>
<area shape="poly" title=" " alt="" coords="88,15,122,15,122,21,88,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a23ac80734740f098e56332da33758ace_icgraph.png" border="0" usemap="#asyscall_8cpp_a23ac80734740f098e56332da33758ace_icgraph" alt=""/></div>
<map name="asyscall_8cpp_a23ac80734740f098e56332da33758ace_icgraph" id="asyscall_8cpp_a23ac80734740f098e56332da33758ace_icgraph">
<area shape="rect" title="主动放弃CPU，让出时间片" alt="" coords="312,5,395,31"/>
<area shape="rect" href="syscall_8cpp.html#a9c01f57bb4ef6f1b91ccce212494a199" title=" " alt="" coords="121,5,264,31"/>
<area shape="poly" title=" " alt="" coords="298,21,264,21,264,15,298,15"/>
<area shape="rect" href="arch_2aarch64_2syscall_8cpp.html#a27f252437c17e7b5d2e8aef749daf1f0" title=" " alt="" coords="5,5,73,31"/>
<area shape="poly" title=" " alt="" coords="108,21,74,21,74,15,108,15"/>
</map>
</div>

</div>
</div>
<a id="a9c01f57bb4ef6f1b91ccce212494a199" name="a9c01f57bb4ef6f1b91ccce212494a199"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c01f57bb4ef6f1b91ccce212494a199">&#9670;&#160;</a></span>syscall_dispatcher()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int syscall_dispatcher </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>syscall_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>args</em>[6]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright The SimpleKernel Contributors </dd></dl>

<p class="definition">Definition at line <a class="el" href="syscall_8cpp_source.html#l00011">11</a> of file <a class="el" href="syscall_8cpp_source.html">syscall.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   11</span>                                                             {</div>
<div class="line"><span class="lineno">   12</span>  int64_t ret = 0;</div>
<div class="line"><span class="lineno">   13</span>  <span class="keywordflow">switch</span> (syscall_id) {</div>
<div class="line"><span class="lineno">   14</span>    <span class="keywordflow">case</span> SYSCALL_WRITE:</div>
<div class="line"><span class="lineno">   15</span>      ret = <a class="code hl_function" href="syscall_8cpp.html#a4fa66935c10e294006b6310af1c68f37">sys_write</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(args[0]),</div>
<div class="line"><span class="lineno">   16</span>                      <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(args[1]),</div>
<div class="line"><span class="lineno">   17</span>                      <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(args[2]));</div>
<div class="line"><span class="lineno">   18</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   19</span>    <span class="keywordflow">case</span> SYSCALL_EXIT:</div>
<div class="line"><span class="lineno">   20</span>      ret = <a class="code hl_function" href="syscall_8cpp.html#a34c7946fbbdfb071d2b453a745dcb9b4">sys_exit</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(args[0]));</div>
<div class="line"><span class="lineno">   21</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   22</span>    <span class="keywordflow">case</span> SYSCALL_YIELD:</div>
<div class="line"><span class="lineno">   23</span>      ret = <a class="code hl_function" href="syscall_8cpp.html#a23ac80734740f098e56332da33758ace">sys_yield</a>();</div>
<div class="line"><span class="lineno">   24</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   25</span>    <span class="keywordflow">case</span> SYSCALL_CLONE:</div>
<div class="line"><span class="lineno">   26</span>      ret = <a class="code hl_function" href="syscall_8cpp.html#a6d9ce836fd264a98548781886f375d2a">sys_clone</a>(args[0], <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(args[1]),</div>
<div class="line"><span class="lineno">   27</span>                      <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">int</span>*<span class="keyword">&gt;</span>(args[2]),</div>
<div class="line"><span class="lineno">   28</span>                      <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">int</span>*<span class="keyword">&gt;</span>(args[3]),</div>
<div class="line"><span class="lineno">   29</span>                      <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(args[4]));</div>
<div class="line"><span class="lineno">   30</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   31</span>    <span class="keywordflow">case</span> SYSCALL_FORK:</div>
<div class="line"><span class="lineno">   32</span>      ret = <a class="code hl_function" href="syscall_8cpp.html#a01fbd4b45143dd51bf6f338d8ee325da">sys_fork</a>();</div>
<div class="line"><span class="lineno">   33</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   34</span>    <span class="keywordflow">case</span> SYSCALL_GETTID:</div>
<div class="line"><span class="lineno">   35</span>      ret = <a class="code hl_function" href="syscall_8cpp.html#a17717d9e7bc25b272fe4dbb63bc52baa">sys_gettid</a>();</div>
<div class="line"><span class="lineno">   36</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   37</span>    <span class="keywordflow">case</span> SYSCALL_SET_TID_ADDRESS:</div>
<div class="line"><span class="lineno">   38</span>      ret = <a class="code hl_function" href="syscall_8cpp.html#ab5c00759c95d8ce9e9db75b1b55a9552">sys_set_tid_address</a>(<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">int</span>*<span class="keyword">&gt;</span>(args[0]));</div>
<div class="line"><span class="lineno">   39</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   40</span>    <span class="keywordflow">case</span> SYSCALL_FUTEX:</div>
<div class="line"><span class="lineno">   41</span>      ret = <a class="code hl_function" href="syscall_8cpp.html#aa03f906affa67ef23ebfbcb79efa569f">sys_futex</a>(</div>
<div class="line"><span class="lineno">   42</span>          <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">int</span>*<span class="keyword">&gt;</span>(args[0]), <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(args[1]),</div>
<div class="line"><span class="lineno">   43</span>          <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(args[2]), <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(args[3]),</div>
<div class="line"><span class="lineno">   44</span>          <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">int</span>*<span class="keyword">&gt;</span>(args[4]), <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(args[5]));</div>
<div class="line"><span class="lineno">   45</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   46</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">   47</span>      <a class="code hl_struct" href="structklog_1_1Err.html">klog::Err</a>(<span class="stringliteral">&quot;[Syscall] Unknown syscall id: %d\n&quot;</span>, syscall_id);</div>
<div class="line"><span class="lineno">   48</span>      ret = -1;</div>
<div class="line"><span class="lineno">   49</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   50</span>  }</div>
<div class="line"><span class="lineno">   51</span>  <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">   52</span>}</div>
<div class="ttc" id="asyscall_8cpp_html_a01fbd4b45143dd51bf6f338d8ee325da"><div class="ttname"><a href="syscall_8cpp.html#a01fbd4b45143dd51bf6f338d8ee325da">sys_fork</a></div><div class="ttdeci">int sys_fork()</div><div class="ttdoc">创建新进程（fork）</div><div class="ttdef"><b>Definition</b> <a href="syscall_8cpp_source.html#l00117">syscall.cpp:117</a></div></div>
<div class="ttc" id="asyscall_8cpp_html_a17717d9e7bc25b272fe4dbb63bc52baa"><div class="ttname"><a href="syscall_8cpp.html#a17717d9e7bc25b272fe4dbb63bc52baa">sys_gettid</a></div><div class="ttdeci">int sys_gettid()</div><div class="ttdoc">获取当前线程ID</div><div class="ttdef"><b>Definition</b> <a href="syscall_8cpp_source.html#l00146">syscall.cpp:146</a></div></div>
<div class="ttc" id="asyscall_8cpp_html_a23ac80734740f098e56332da33758ace"><div class="ttname"><a href="syscall_8cpp.html#a23ac80734740f098e56332da33758ace">sys_yield</a></div><div class="ttdeci">int sys_yield()</div><div class="ttdoc">主动放弃CPU，让出时间片</div><div class="ttdef"><b>Definition</b> <a href="syscall_8cpp_source.html#l00077">syscall.cpp:77</a></div></div>
<div class="ttc" id="asyscall_8cpp_html_a34c7946fbbdfb071d2b453a745dcb9b4"><div class="ttname"><a href="syscall_8cpp.html#a34c7946fbbdfb071d2b453a745dcb9b4">sys_exit</a></div><div class="ttdeci">int sys_exit(int code)</div><div class="ttdoc">退出当前进程或线程</div><div class="ttdef"><b>Definition</b> <a href="syscall_8cpp_source.html#l00067">syscall.cpp:67</a></div></div>
<div class="ttc" id="asyscall_8cpp_html_a4fa66935c10e294006b6310af1c68f37"><div class="ttname"><a href="syscall_8cpp.html#a4fa66935c10e294006b6310af1c68f37">sys_write</a></div><div class="ttdeci">int sys_write(int fd, const char *buf, size_t len)</div><div class="ttdoc">向文件描述符写入数据</div><div class="ttdef"><b>Definition</b> <a href="syscall_8cpp_source.html#l00054">syscall.cpp:54</a></div></div>
<div class="ttc" id="asyscall_8cpp_html_a6d9ce836fd264a98548781886f375d2a"><div class="ttname"><a href="syscall_8cpp.html#a6d9ce836fd264a98548781886f375d2a">sys_clone</a></div><div class="ttdeci">int sys_clone(uint64_t flags, void *stack, int *parent_tid, int *child_tid, void *tls)</div><div class="ttdoc">创建新线程（或进程）</div><div class="ttdef"><b>Definition</b> <a href="syscall_8cpp_source.html#l00087">syscall.cpp:87</a></div></div>
<div class="ttc" id="asyscall_8cpp_html_aa03f906affa67ef23ebfbcb79efa569f"><div class="ttname"><a href="syscall_8cpp.html#aa03f906affa67ef23ebfbcb79efa569f">sys_futex</a></div><div class="ttdeci">int sys_futex(int *uaddr, int op, int val, const void *timeout, int *uaddr2, int val3)</div><div class="ttdoc">快速用户空间互斥锁操作（futex）</div><div class="ttdef"><b>Definition</b> <a href="syscall_8cpp_source.html#l00170">syscall.cpp:170</a></div></div>
<div class="ttc" id="asyscall_8cpp_html_ab5c00759c95d8ce9e9db75b1b55a9552"><div class="ttname"><a href="syscall_8cpp.html#ab5c00759c95d8ce9e9db75b1b55a9552">sys_set_tid_address</a></div><div class="ttdeci">int sys_set_tid_address(int *tidptr)</div><div class="ttdoc">设置线程ID地址（用于线程退出时的清理）</div><div class="ttdef"><b>Definition</b> <a href="syscall_8cpp_source.html#l00155">syscall.cpp:155</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a9c01f57bb4ef6f1b91ccce212494a199_cgraph.png" border="0" usemap="#asyscall_8cpp_a9c01f57bb4ef6f1b91ccce212494a199_cgraph" alt=""/></div>
<map name="asyscall_8cpp_a9c01f57bb4ef6f1b91ccce212494a199_cgraph" id="asyscall_8cpp_a9c01f57bb4ef6f1b91ccce212494a199_cgraph">
<area shape="rect" title=" " alt="" coords="5,179,148,204"/>
<area shape="rect" href="syscall_8cpp.html#a6d9ce836fd264a98548781886f375d2a" title="创建新线程（或进程）" alt="" coords="229,5,316,31"/>
<area shape="poly" title=" " alt="" coords="82,177,124,112,156,73,194,40,215,29,217,34,198,44,160,77,128,115,87,180"/>
<area shape="rect" href="syscall_8cpp.html#a34c7946fbbdfb071d2b453a745dcb9b4" title="退出当前进程或线程" alt="" coords="235,55,311,80"/>
<area shape="poly" title=" " alt="" coords="88,176,132,134,162,110,195,89,221,78,223,82,197,94,165,114,136,138,92,180"/>
<area shape="rect" href="syscall_8cpp.html#a01fbd4b45143dd51bf6f338d8ee325da" title="创建新进程（fork）" alt="" coords="234,104,311,129"/>
<area shape="poly" title=" " alt="" coords="105,176,195,138,220,129,222,134,197,143,107,181"/>
<area shape="rect" href="syscall_8cpp.html#aa03f906affa67ef23ebfbcb79efa569f" title="快速用户空间互斥锁操作（futex）" alt="" coords="230,153,315,179"/>
<area shape="poly" title=" " alt="" coords="148,179,216,171,216,176,149,185"/>
<area shape="rect" href="syscall_8cpp.html#a17717d9e7bc25b272fe4dbb63bc52baa" title="获取当前线程ID" alt="" coords="228,203,317,228"/>
<area shape="poly" title=" " alt="" coords="149,197,214,206,214,211,148,203"/>
<area shape="rect" href="syscall_8cpp.html#ab5c00759c95d8ce9e9db75b1b55a9552" title="设置线程ID地址（用于线程退出时的清理）" alt="" coords="196,252,349,277"/>
<area shape="poly" title=" " alt="" coords="109,202,197,237,220,245,218,250,195,242,107,207"/>
<area shape="rect" href="syscall_8cpp.html#a4fa66935c10e294006b6310af1c68f37" title="向文件描述符写入数据" alt="" coords="231,351,315,376"/>
<area shape="poly" title=" " alt="" coords="87,203,129,266,160,304,198,336,219,347,216,352,194,340,156,307,124,269,83,206"/>
<area shape="rect" href="syscall_8cpp.html#a23ac80734740f098e56332da33758ace" title="主动放弃CPU，让出时间片" alt="" coords="231,301,314,327"/>
<area shape="poly" title=" " alt="" coords="92,203,137,243,166,266,197,286,219,296,217,301,195,291,163,271,133,247,89,206"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="397,153,567,179"/>
<area shape="poly" title=" " alt="" coords="317,25,351,40,385,63,416,90,464,141,460,145,412,94,381,67,348,44,315,30"/>
<area shape="poly" title=" " alt="" coords="312,75,350,89,405,116,451,144,449,148,402,121,348,94,310,80"/>
<area shape="poly" title=" " alt="" coords="312,123,415,148,414,153,311,128"/>
<area shape="poly" title=" " alt="" coords="316,163,383,163,383,169,316,169"/>
<area shape="poly" title=" " alt="" coords="317,202,414,179,415,184,318,207"/>
<area shape="poly" title=" " alt="" coords="315,249,348,237,401,210,448,184,450,188,404,215,350,242,317,254"/>
<area shape="rect" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f" title=" " alt="" coords="443,351,521,376"/>
<area shape="poly" title=" " alt="" coords="315,361,429,361,429,366,315,366"/>
<area shape="poly" title=" " alt="" coords="313,302,348,286,381,263,412,237,460,187,463,191,415,241,384,268,351,291,315,306"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="syscall_8cpp_a9c01f57bb4ef6f1b91ccce212494a199_icgraph.png" border="0" usemap="#asyscall_8cpp_a9c01f57bb4ef6f1b91ccce212494a199_icgraph" alt=""/></div>
<map name="asyscall_8cpp_a9c01f57bb4ef6f1b91ccce212494a199_icgraph" id="asyscall_8cpp_a9c01f57bb4ef6f1b91ccce212494a199_icgraph">
<area shape="rect" title=" " alt="" coords="121,5,264,31"/>
<area shape="rect" href="arch_2aarch64_2syscall_8cpp.html#a27f252437c17e7b5d2e8aef749daf1f0" title=" " alt="" coords="5,5,73,31"/>
<area shape="poly" title=" " alt="" coords="108,21,74,21,74,15,108,15"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="syscall_8cpp.html">syscall.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
