<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SimpleKernel: /root/tests/system_test/virtual_memory_test.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SimpleKernel<span id="projectnumber">&#160;1.17.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('system__test_2virtual__memory__test_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">virtual_memory_test.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="virtual__memory_8hpp_source.html">virtual_memory.hpp</a>&quot;</code><br />
<code>#include &lt;<a class="el" href="cpu__io_8h_source.html">cpu_io.h</a>&gt;</code><br />
<code>#include &lt;cstddef&gt;</code><br />
<code>#include &lt;cstdint&gt;</code><br />
<code>#include &quot;<a class="el" href="arch_8h_source.html">arch.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="basic__info_8hpp_source.html">basic_info.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="kernel_8h_source.html">kernel.h</a>&quot;</code><br />
<code>#include &quot;sk_cstdio&quot;</code><br />
<code>#include &quot;sk_cstring&quot;</code><br />
<code>#include &quot;<a class="el" href="sk__libcxx_8h_source.html">sk_libcxx.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sk__stdlib_8h_source.html">sk_stdlib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="system__test_8h_source.html">system_test.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for virtual_memory_test.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="system__test_2virtual__memory__test_8cpp__incl.png" border="0" usemap="#a_2root_2tests_2system__test_2virtual__memory__test_8cpp" alt=""/></div>
<map name="a_2root_2tests_2system__test_2virtual__memory__test_8cpp" id="a_2root_2tests_2system__test_2virtual__memory__test_8cpp">
<area shape="rect" title=" " alt="" coords="1774,5,1937,60"/>
<area shape="rect" href="virtual__memory_8hpp.html" title=" " alt="" coords="1349,108,1501,133"/>
<area shape="poly" title=" " alt="" coords="1774,53,1496,108,1495,103,1773,48"/>
<area shape="rect" href="cpu__io_8h.html" title=" " alt="" coords="533,401,609,427"/>
<area shape="poly" title=" " alt="" coords="1774,39,1521,47,1194,61,896,82,789,95,727,111,694,125,668,141,651,161,645,193,645,269,639,305,626,339,592,392,588,389,621,336,634,303,639,268,639,192,646,159,664,137,691,121,725,105,788,90,895,77,1194,56,1521,41,1774,33"/>
<area shape="rect" title=" " alt="" coords="709,548,780,573"/>
<area shape="poly" title=" " alt="" coords="1774,40,1505,54,1336,66,1163,83,1003,103,870,129,819,143,780,159,755,176,749,184,747,193,747,415,747,534,742,534,742,415,742,192,744,182,752,172,777,154,817,138,869,123,1002,98,1163,77,1335,61,1505,49,1774,34"/>
<area shape="rect" title=" " alt="" coords="1322,548,1389,573"/>
<area shape="poly" title=" " alt="" coords="1937,36,1993,44,2055,57,2119,77,2178,106,2208,123,2232,139,2248,161,2254,192,2254,416,2248,452,2231,476,2204,489,2171,494,2092,495,2049,497,2006,503,1833,532,1662,549,1511,558,1403,562,1402,556,1511,553,1661,544,1833,526,2006,497,2049,491,2092,490,2171,489,2203,484,2227,472,2243,450,2249,415,2249,193,2243,163,2228,143,2205,127,2175,110,2117,82,2054,62,1992,49,1936,42"/>
<area shape="rect" href="basic__info_8hpp.html" title=" " alt="" coords="1124,181,1240,207"/>
<area shape="poly" title=" " alt="" coords="1774,39,1683,46,1573,58,1454,79,1338,111,1268,142,1211,176,1208,171,1265,137,1336,105,1453,74,1572,53,1682,40,1774,34"/>
<area shape="rect" title=" " alt="" coords="1731,401,1814,427"/>
<area shape="poly" title=" " alt="" coords="1847,61,1827,121,1820,157,1817,193,1817,269,1814,302,1806,335,1787,390,1782,388,1801,334,1808,301,1811,269,1811,193,1814,156,1822,120,1842,60"/>
<area shape="rect" href="sk__stdlib_8h.html" title=" " alt="" coords="1852,181,1944,207"/>
<area shape="poly" title=" " alt="" coords="1865,60,1894,167,1889,169,1860,61"/>
<area shape="rect" href="arch_8h.html" title=" " alt="" coords="540,328,603,353"/>
<area shape="poly" title=" " alt="" coords="1774,36,1496,37,1134,45,957,54,804,67,688,86,649,97,625,110,605,131,591,156,581,184,574,213,569,269,571,314,566,314,564,269,569,212,576,182,586,154,601,128,622,106,647,92,687,81,803,62,957,49,1133,40,1496,31,1774,31"/>
<area shape="rect" href="kernel_8h.html" title=" " alt="" coords="2001,255,2075,280"/>
<area shape="poly" title=" " alt="" coords="1878,59,2022,242,2018,245,1874,62"/>
<area shape="rect" title=" " alt="" coords="2289,108,2377,133"/>
<area shape="poly" title=" " alt="" coords="1937,46,2270,105,2276,106,2275,112,2270,111,1936,51"/>
<area shape="rect" href="sk__libcxx_8h.html" title=" " alt="" coords="2109,255,2204,280"/>
<area shape="poly" title=" " alt="" coords="1937,32,1989,39,2045,52,2099,73,2148,106,2168,128,2178,151,2180,177,2177,207,2168,242,2163,241,2171,206,2174,176,2173,152,2163,131,2144,110,2097,78,2043,57,1988,44,1936,38"/>
<area shape="rect" href="system__test_8h.html" title=" " alt="" coords="2019,108,2134,133"/>
<area shape="poly" title=" " alt="" coords="1924,58,2035,100,2033,105,1922,63"/>
<area shape="poly" title=" " alt="" coords="1349,124,1209,125,1042,132,960,140,885,151,823,165,778,184,753,202,736,220,716,262,698,307,683,331,663,355,635,378,606,397,603,392,632,374,659,351,679,328,693,304,711,259,732,217,750,198,775,179,822,160,884,145,959,135,1042,127,1209,119,1349,118"/>
<area shape="poly" title=" " alt="" coords="1349,133,1233,150,1101,177,1039,193,983,212,939,233,909,256,890,287,882,316,881,346,885,375,888,405,889,436,881,468,863,502,848,517,831,530,794,548,792,543,828,526,845,513,859,498,876,466,883,436,883,406,879,376,876,346,876,316,885,285,905,253,936,229,981,207,1037,188,1100,171,1233,145,1348,128"/>
<area shape="poly" title=" " alt="" coords="1501,125,1637,144,1698,159,1722,169,1740,179,1800,235,1824,264,1842,294,1852,325,1854,358,1846,392,1828,428,1800,454,1757,477,1701,497,1639,515,1509,541,1403,556,1402,551,1508,536,1637,509,1700,492,1755,473,1797,450,1824,425,1841,390,1849,357,1847,326,1837,296,1820,267,1796,239,1736,183,1720,173,1697,164,1636,149,1500,131"/>
<area shape="rect" title=" " alt="" coords="1417,181,1520,207"/>
<area shape="poly" title=" " alt="" coords="1434,132,1457,168,1452,171,1430,135"/>
<area shape="rect" title=" " alt="" coords="1545,181,1611,207"/>
<area shape="poly" title=" " alt="" coords="1450,131,1542,173,1540,178,1448,136"/>
<area shape="poly" title=" " alt="" coords="1386,136,1235,180,1233,175,1385,131"/>
<area shape="rect" href="kernel__log_8hpp.html" title=" " alt="" coords="1159,255,1277,280"/>
<area shape="poly" title=" " alt="" coords="1399,136,1357,156,1312,184,1272,215,1240,247,1236,243,1269,211,1308,179,1354,152,1396,131"/>
<area shape="rect" href="singleton_8hpp.html" title=" " alt="" coords="1615,328,1725,353"/>
<area shape="poly" title=" " alt="" coords="1407,136,1387,150,1369,167,1359,187,1359,196,1363,205,1379,222,1403,238,1470,271,1548,299,1617,322,1616,327,1546,304,1468,276,1400,243,1375,226,1358,208,1354,197,1354,185,1365,164,1383,146,1403,131"/>
<area shape="rect" href="expected_8hpp.html" title=" " alt="" coords="1555,401,1665,427"/>
<area shape="poly" title=" " alt="" coords="1419,135,1403,169,1401,188,1407,205,1431,225,1470,241,1571,265,1673,288,1713,305,1739,326,1745,339,1744,351,1730,371,1703,387,1672,400,1670,395,1701,383,1726,367,1739,350,1739,340,1735,330,1710,309,1671,293,1570,270,1468,246,1429,230,1402,208,1396,188,1398,167,1414,132"/>
<area shape="rect" title=" " alt="" coords="1635,181,1726,207"/>
<area shape="poly" title=" " alt="" coords="1467,131,1627,175,1626,180,1465,136"/>
<area shape="poly" title=" " alt="" coords="1501,131,1838,181,1838,186,1500,136"/>
<area shape="rect" title=" " alt="" coords="782,475,849,500"/>
<area shape="poly" title=" " alt="" coords="610,424,770,470,768,475,609,429"/>
<area shape="rect" title=" " alt="" coords="537,475,606,500"/>
<area shape="poly" title=" " alt="" coords="574,427,574,461,569,461,569,427"/>
<area shape="poly" title=" " alt="" coords="558,429,543,444,529,462,522,481,523,490,527,498,537,507,553,516,597,531,696,550,695,556,595,536,551,521,534,512,523,502,517,491,516,481,524,460,539,440,555,425"/>
<area shape="poly" title=" " alt="" coords="583,425,621,463,648,482,676,498,731,513,804,526,985,543,1169,553,1308,556,1308,561,1169,558,984,549,804,531,730,518,674,502,645,487,618,467,580,429"/>
<area shape="rect" title=" " alt="" coords="154,548,218,573"/>
<area shape="poly" title=" " alt="" coords="533,422,305,448,196,464,160,471,145,477,140,490,143,506,152,522,165,536,160,540,148,525,138,508,134,490,141,473,159,466,195,459,304,443,533,417"/>
<area shape="rect" title=" " alt="" coords="349,548,413,573"/>
<area shape="poly" title=" " alt="" coords="557,429,408,542,405,538,554,425"/>
<area shape="rect" title=" " alt="" coords="5,548,129,573"/>
<area shape="poly" title=" " alt="" coords="533,421,308,445,196,462,156,470,134,477,117,489,103,505,81,537,77,534,99,501,114,485,131,472,155,464,195,456,308,440,533,416"/>
<area shape="rect" href="test__environment__state_8hpp.html" title=" " alt="" coords="155,475,361,500"/>
<area shape="poly" title=" " alt="" coords="533,427,322,474,321,469,532,421"/>
<area shape="poly" title=" " alt="" coords="337,497,696,550,695,555,336,503"/>
<area shape="poly" title=" " alt="" coords="361,493,1309,554,1308,559,361,498"/>
<area shape="poly" title=" " alt="" coords="248,502,209,540,206,536,244,498"/>
<area shape="poly" title=" " alt="" coords="279,498,350,539,348,543,276,502"/>
<area shape="poly" title=" " alt="" coords="228,503,112,545,110,540,226,498"/>
<area shape="rect" title=" " alt="" coords="243,548,305,573"/>
<area shape="poly" title=" " alt="" coords="263,500,271,534,266,535,258,501"/>
<area shape="poly" title=" " alt="" coords="1124,205,1013,224,963,239,930,257,918,272,913,288,910,328,908,354,911,378,921,418,925,438,925,458,919,479,907,502,884,525,855,541,824,552,794,558,793,553,823,547,853,536,880,521,903,498,915,477,919,457,919,438,916,420,906,378,903,355,905,328,908,287,913,270,927,253,961,234,1011,219,1123,200"/>
<area shape="poly" title=" " alt="" coords="1124,208,1047,227,1007,241,970,257,940,277,921,299,916,311,914,324,917,337,924,352,962,399,1007,438,1059,471,1114,497,1169,517,1221,532,1309,551,1307,556,1220,538,1167,522,1112,502,1056,475,1004,443,958,403,920,355,912,339,909,324,911,310,916,296,937,273,967,253,1005,236,1045,222,1123,203"/>
<area shape="poly" title=" " alt="" coords="1190,206,1208,241,1204,244,1186,208"/>
<area shape="poly" title=" " alt="" coords="1203,204,1278,245,1347,277,1450,299,1601,325,1600,330,1449,304,1345,283,1276,250,1201,209"/>
<area shape="rect" title=" " alt="" coords="935,328,1037,353"/>
<area shape="poly" title=" " alt="" coords="1168,209,1015,322,1011,317,1165,205"/>
<area shape="poly" title=" " alt="" coords="1240,278,1268,298,1294,326,1321,381,1340,438,1351,492,1356,534,1351,534,1345,493,1334,440,1316,383,1289,330,1264,302,1237,282"/>
<area shape="rect" title=" " alt="" coords="1483,328,1539,353"/>
<area shape="poly" title=" " alt="" coords="1270,277,1470,325,1469,330,1269,283"/>
<area shape="rect" title=" " alt="" coords="1061,328,1132,353"/>
<area shape="poly" title=" " alt="" coords="1200,282,1129,323,1127,319,1197,278"/>
<area shape="rect" title=" " alt="" coords="1156,328,1280,353"/>
<area shape="poly" title=" " alt="" coords="1221,280,1221,314,1215,314,1215,280"/>
<area shape="poly" title=" " alt="" coords="1278,275,1601,326,1600,331,1277,281"/>
<area shape="poly" title=" " alt="" coords="1277,276,1438,303,1552,325,1578,338,1603,351,1723,395,1722,400,1601,356,1576,342,1551,331,1437,308,1276,281"/>
<area shape="poly" title=" " alt="" coords="1182,283,1037,327,1036,321,1180,277"/>
<area shape="rect" href="spinlock_8hpp.html" title=" " alt="" coords="1355,328,1459,353"/>
<area shape="poly" title=" " alt="" coords="1249,278,1364,320,1363,325,1247,283"/>
<area shape="poly" title=" " alt="" coords="1355,350,1292,356,623,411,623,406,1291,351,1355,345"/>
<area shape="poly" title=" " alt="" coords="1361,356,863,477,862,472,1360,351"/>
<area shape="poly" title=" " alt="" coords="1378,356,1200,420,956,503,794,549,793,544,955,497,1198,415,1376,351"/>
<area shape="poly" title=" " alt="" coords="1460,350,1718,399,1717,405,1459,355"/>
<area shape="rect" title=" " alt="" coords="1367,401,1447,427"/>
<area shape="poly" title=" " alt="" coords="1410,354,1410,388,1405,388,1405,354"/>
<area shape="rect" title=" " alt="" coords="1471,401,1530,427"/>
<area shape="poly" title=" " alt="" coords="1424,351,1476,391,1473,395,1421,355"/>
<area shape="poly" title=" " alt="" coords="1441,351,1565,394,1564,399,1439,356"/>
<area shape="poly" title=" " alt="" coords="1591,429,1389,544,1386,539,1588,425"/>
<area shape="rect" title=" " alt="" coords="1569,475,1651,500"/>
<area shape="poly" title=" " alt="" coords="1613,427,1613,461,1607,461,1607,427"/>
<area shape="rect" title=" " alt="" coords="1851,255,1926,280"/>
<area shape="poly" title=" " alt="" coords="1899,207,1895,242,1889,241,1894,207"/>
<area shape="poly" title=" " alt="" coords="574,354,574,388,569,388,569,354"/>
<area shape="poly" title=" " alt="" coords="559,355,540,376,523,403,511,430,503,453,504,475,516,498,527,508,544,517,591,532,696,551,695,556,590,537,542,522,524,512,512,502,499,476,498,452,506,428,518,400,535,373,556,352"/>
<area shape="poly" title=" " alt="" coords="583,352,612,382,656,423,710,465,771,498,817,511,879,523,1031,540,1187,550,1308,555,1308,561,1187,555,1030,545,878,528,816,516,769,502,707,469,652,427,608,386,579,355"/>
<area shape="rect" title=" " alt="" coords="316,401,411,427"/>
<area shape="poly" title=" " alt="" coords="541,355,411,399,409,394,539,350"/>
<area shape="poly" title=" " alt="" coords="2039,281,2032,324,2015,385,2001,418,1984,449,1962,478,1935,502,1905,514,1852,524,1701,540,1403,560,1402,555,1701,535,1851,518,1904,508,1933,498,1958,474,1980,446,1997,415,2010,383,2027,323,2034,280"/>
<area shape="poly" title=" " alt="" coords="2154,282,2131,325,2091,387,2037,451,2004,479,1969,502,1921,520,1856,534,1696,552,1530,560,1402,562,1402,557,1530,555,1695,546,1855,529,1919,515,1966,498,2001,475,2033,447,2087,384,2126,323,2149,279"/>
<area shape="poly" title=" " alt="" coords="2070,135,2017,200,1940,282,1866,346,1801,395,1798,391,1863,342,1936,278,2013,196,2065,132"/>
<area shape="rect" title=" " alt="" coords="2071,181,2163,207"/>
<area shape="poly" title=" " alt="" coords="2086,132,2106,168,2101,171,2081,135"/>
</map>
</div>
</div>
<p><a href="system__test_2virtual__memory__test_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9c36d0fe3ec4675cbffdc9b52f5fb399" id="r_a9c36d0fe3ec4675cbffdc9b52f5fb399"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="system__test_2virtual__memory__test_8cpp.html#a9c36d0fe3ec4675cbffdc9b52f5fb399">malloc</a> (size_t size)</td></tr>
<tr class="separator:a9c36d0fe3ec4675cbffdc9b52f5fb399"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbedc913aa4651b3c3b4b3aecd9b4711" id="r_afbedc913aa4651b3c3b4b3aecd9b4711"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="system__test_2virtual__memory__test_8cpp.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a> (void *ptr)</td></tr>
<tr class="separator:afbedc913aa4651b3c3b4b3aecd9b4711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8006724372b77924155bd8618fe57516" id="r_a8006724372b77924155bd8618fe57516"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="system__test_2virtual__memory__test_8cpp.html#a8006724372b77924155bd8618fe57516">aligned_alloc</a> (size_t alignment, size_t size)</td></tr>
<tr class="separator:a8006724372b77924155bd8618fe57516"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8027cdd5d224276fe32cfe407e4dfe88" id="r_a8027cdd5d224276fe32cfe407e4dfe88"><td class="memItemLeft" align="right" valign="top">auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="system__test_2virtual__memory__test_8cpp.html#a8027cdd5d224276fe32cfe407e4dfe88">virtual_memory_test</a> () -&gt; bool</td></tr>
<tr class="separator:a8027cdd5d224276fe32cfe407e4dfe88"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8006724372b77924155bd8618fe57516" name="a8006724372b77924155bd8618fe57516"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8006724372b77924155bd8618fe57516">&#9670;&#160;</a></span>aligned_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * aligned_alloc </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>alignment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="memory_8cpp_source.html#l00062">62</a> of file <a class="el" href="memory_8cpp_source.html">memory.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   62</span>                                                              {</div>
<div class="line"><span class="lineno">   63</span>  <span class="keywordflow">if</span> (allocator) {</div>
<div class="line"><span class="lineno">   64</span>    <span class="keywordflow">return</span> allocator-&gt;aligned_alloc(alignment, size);</div>
<div class="line"><span class="lineno">   65</span>  }</div>
<div class="line"><span class="lineno">   66</span>  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   67</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="system__test_2virtual__memory__test_8cpp_a8006724372b77924155bd8618fe57516_icgraph.png" border="0" usemap="#asystem__test_2virtual__memory__test_8cpp_a8006724372b77924155bd8618fe57516_icgraph" alt=""/></div>
<map name="asystem__test_2virtual__memory__test_8cpp_a8006724372b77924155bd8618fe57516_icgraph" id="asystem__test_2virtual__memory__test_8cpp_a8006724372b77924155bd8618fe57516_icgraph">
<area shape="rect" title=" " alt="" coords="212,5,320,31"/>
<area shape="rect" href="system__test_2virtual__memory__test_8cpp.html#a8027cdd5d224276fe32cfe407e4dfe88" title=" " alt="" coords="5,5,164,31"/>
<area shape="poly" title=" " alt="" coords="198,21,164,21,164,15,198,15"/>
</map>
</div>

</div>
</div>
<a id="afbedc913aa4651b3c3b4b3aecd9b4711" name="afbedc913aa4651b3c3b4b3aecd9b4711"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbedc913aa4651b3c3b4b3aecd9b4711">&#9670;&#160;</a></span>free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="memory_8cpp_source.html#l00042">42</a> of file <a class="el" href="memory_8cpp_source.html">memory.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   42</span>                                {</div>
<div class="line"><span class="lineno">   43</span>  <span class="keywordflow">if</span> (allocator) {</div>
<div class="line"><span class="lineno">   44</span>    allocator-&gt;free(ptr);</div>
<div class="line"><span class="lineno">   45</span>  }</div>
<div class="line"><span class="lineno">   46</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9c36d0fe3ec4675cbffdc9b52f5fb399" name="a9c36d0fe3ec4675cbffdc9b52f5fb399"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c36d0fe3ec4675cbffdc9b52f5fb399">&#9670;&#160;</a></span>malloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * malloc </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright The SimpleKernel Contributors </dd></dl>

<p class="definition">Definition at line <a class="el" href="memory_8cpp_source.html#l00035">35</a> of file <a class="el" href="memory_8cpp_source.html">memory.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   35</span>                                     {</div>
<div class="line"><span class="lineno">   36</span>  <span class="keywordflow">if</span> (allocator) {</div>
<div class="line"><span class="lineno">   37</span>    <span class="keywordflow">return</span> allocator-&gt;malloc(size);</div>
<div class="line"><span class="lineno">   38</span>  }</div>
<div class="line"><span class="lineno">   39</span>  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   40</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8027cdd5d224276fe32cfe407e4dfe88" name="a8027cdd5d224276fe32cfe407e4dfe88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8027cdd5d224276fe32cfe407e4dfe88">&#9670;&#160;</a></span>virtual_memory_test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">auto virtual_memory_test </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> -&gt; bool </td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="system__test_2virtual__memory__test_8cpp_source.html#l00030">30</a> of file <a class="el" href="system__test_2virtual__memory__test_8cpp_source.html">virtual_memory_test.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   30</span>                                   {</div>
<div class="line"><span class="lineno">   31</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: start\n&quot;</span>);</div>
<div class="line"><span class="lineno">   32</span> </div>
<div class="line"><span class="lineno">   33</span>  <span class="keyword">auto</span>&amp; vm = <a class="code hl_function" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton&lt;VirtualMemory&gt;::GetInstance</a>();</div>
<div class="line"><span class="lineno">   34</span> </div>
<div class="line"><span class="lineno">   35</span>  <span class="comment">// Test 1: 创建用户页表</span></div>
<div class="line"><span class="lineno">   36</span>  <span class="keywordtype">void</span>* user_page_dir = <a class="code hl_function" href="system__test_2virtual__memory__test_8cpp.html#a8006724372b77924155bd8618fe57516">aligned_alloc</a>(<a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>,</div>
<div class="line"><span class="lineno">   37</span>                                      <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">   38</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(user_page_dir != <span class="keyword">nullptr</span>,</div>
<div class="line"><span class="lineno">   39</span>              <span class="stringliteral">&quot;virtual_memory_test: failed to create user page directory&quot;</span>);</div>
<div class="line"><span class="lineno">   40</span>  std::memset(user_page_dir, 0, <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">   41</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: user page directory created at %p\n&quot;</span>,</div>
<div class="line"><span class="lineno">   42</span>            user_page_dir);</div>
<div class="line"><span class="lineno">   43</span> </div>
<div class="line"><span class="lineno">   44</span>  <span class="comment">// Test 2: 映射页面</span></div>
<div class="line"><span class="lineno">   45</span>  <span class="keywordtype">void</span>* virt_addr = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x200000);</div>
<div class="line"><span class="lineno">   46</span>  <span class="keywordtype">void</span>* phys_addr = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x90000000);</div>
<div class="line"><span class="lineno">   47</span> </div>
<div class="line"><span class="lineno">   48</span>  <span class="keyword">auto</span> map_result =</div>
<div class="line"><span class="lineno">   49</span>      vm.MapPage(user_page_dir, virt_addr, phys_addr,</div>
<div class="line"><span class="lineno">   50</span>                 <a class="code hl_function" href="namespacecpu__io_1_1virtual__memory.html#af2bed9d8a049c2d40634b15b8e3adca9">cpu_io::virtual_memory::GetUserPagePermissions</a>());</div>
<div class="line"><span class="lineno">   51</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(map_result.has_value(),</div>
<div class="line"><span class="lineno">   52</span>              <span class="stringliteral">&quot;virtual_memory_test: failed to map page&quot;</span>);</div>
<div class="line"><span class="lineno">   53</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: mapped va=%p to pa=%p\n&quot;</span>, virt_addr,</div>
<div class="line"><span class="lineno">   54</span>            phys_addr);</div>
<div class="line"><span class="lineno">   55</span> </div>
<div class="line"><span class="lineno">   56</span>  <span class="comment">// Test 3: 获取映射</span></div>
<div class="line"><span class="lineno">   57</span>  <span class="keyword">auto</span> mapped = vm.GetMapping(user_page_dir, virt_addr);</div>
<div class="line"><span class="lineno">   58</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(mapped.has_value(), <span class="stringliteral">&quot;virtual_memory_test: failed to get mapping&quot;</span>);</div>
<div class="line"><span class="lineno">   59</span>  <span class="keywordflow">if</span> (mapped) {</div>
<div class="line"><span class="lineno">   60</span>    <a class="code hl_define" href="system__test_8h.html#abfc1b6826e51b93338e02cabfa5cfcd1">EXPECT_EQ</a>(*mapped, phys_addr,</div>
<div class="line"><span class="lineno">   61</span>              <span class="stringliteral">&quot;virtual_memory_test: mapping address mismatch&quot;</span>);</div>
<div class="line"><span class="lineno">   62</span>    <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: verified mapping pa=%p\n&quot;</span>, *mapped);</div>
<div class="line"><span class="lineno">   63</span>  }</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>  <span class="comment">// Test 4: 映射多个页面</span></div>
<div class="line"><span class="lineno">   66</span>  <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> kNumPages = 5;</div>
<div class="line"><span class="lineno">   67</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; kNumPages; ++i) {</div>
<div class="line"><span class="lineno">   68</span>    <span class="keywordtype">void</span>* va = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x300000 +</div>
<div class="line"><span class="lineno">   69</span>                                       i * <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">   70</span>    <span class="keywordtype">void</span>* pa = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x91000000 +</div>
<div class="line"><span class="lineno">   71</span>                                       i * <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>    <span class="keyword">auto</span> result = vm.MapPage(user_page_dir, va, pa,</div>
<div class="line"><span class="lineno">   74</span>                             <a class="code hl_function" href="namespacecpu__io_1_1virtual__memory.html#af2bed9d8a049c2d40634b15b8e3adca9">cpu_io::virtual_memory::GetUserPagePermissions</a>());</div>
<div class="line"><span class="lineno">   75</span>    <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(result.has_value(),</div>
<div class="line"><span class="lineno">   76</span>                <span class="stringliteral">&quot;virtual_memory_test: failed to map multiple pages&quot;</span>);</div>
<div class="line"><span class="lineno">   77</span>  }</div>
<div class="line"><span class="lineno">   78</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: mapped %zu pages\n&quot;</span>, kNumPages);</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span>  <span class="comment">// Test 5: 验证多页映射</span></div>
<div class="line"><span class="lineno">   81</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; kNumPages; ++i) {</div>
<div class="line"><span class="lineno">   82</span>    <span class="keywordtype">void</span>* va = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x300000 +</div>
<div class="line"><span class="lineno">   83</span>                                       i * <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordtype">void</span>* pa = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x91000000 +</div>
<div class="line"><span class="lineno">   85</span>                                       i * <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>    <span class="keyword">auto</span> m = vm.GetMapping(user_page_dir, va);</div>
<div class="line"><span class="lineno">   88</span>    <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(m.has_value(),</div>
<div class="line"><span class="lineno">   89</span>                <span class="stringliteral">&quot;virtual_memory_test: multiple page mapping not found&quot;</span>);</div>
<div class="line"><span class="lineno">   90</span>    <span class="keywordflow">if</span> (m) {</div>
<div class="line"><span class="lineno">   91</span>      <a class="code hl_define" href="system__test_8h.html#abfc1b6826e51b93338e02cabfa5cfcd1">EXPECT_EQ</a>(*m, pa, <span class="stringliteral">&quot;virtual_memory_test: multiple page mapping mismatch&quot;</span>);</div>
<div class="line"><span class="lineno">   92</span>    }</div>
<div class="line"><span class="lineno">   93</span>  }</div>
<div class="line"><span class="lineno">   94</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: verified %zu page mappings\n&quot;</span>, kNumPages);</div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>  <span class="comment">// Test 6: 取消映射</span></div>
<div class="line"><span class="lineno">   97</span>  <span class="keyword">auto</span> unmap_result = vm.UnmapPage(user_page_dir, virt_addr);</div>
<div class="line"><span class="lineno">   98</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(unmap_result.has_value(),</div>
<div class="line"><span class="lineno">   99</span>              <span class="stringliteral">&quot;virtual_memory_test: failed to unmap page&quot;</span>);</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>  <span class="keyword">auto</span> unmapped = vm.GetMapping(user_page_dir, virt_addr);</div>
<div class="line"><span class="lineno">  102</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(!unmapped.has_value(),</div>
<div class="line"><span class="lineno">  103</span>              <span class="stringliteral">&quot;virtual_memory_test: page still mapped after unmap&quot;</span>);</div>
<div class="line"><span class="lineno">  104</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: unmapped va=%p\n&quot;</span>, virt_addr);</div>
<div class="line"><span class="lineno">  105</span> </div>
<div class="line"><span class="lineno">  106</span>  <span class="comment">// Test 7: 克隆页表（复制映射）</span></div>
<div class="line"><span class="lineno">  107</span>  <span class="keyword">auto</span> clone_result = vm.ClonePageDirectory(user_page_dir, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  108</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(clone_result.has_value(),</div>
<div class="line"><span class="lineno">  109</span>              <span class="stringliteral">&quot;virtual_memory_test: failed to clone page directory&quot;</span>);</div>
<div class="line"><span class="lineno">  110</span>  <span class="keywordtype">void</span>* cloned_page_dir = clone_result.value();</div>
<div class="line"><span class="lineno">  111</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(cloned_page_dir != user_page_dir,</div>
<div class="line"><span class="lineno">  112</span>              <span class="stringliteral">&quot;virtual_memory_test: cloned page dir same as source&quot;</span>);</div>
<div class="line"><span class="lineno">  113</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: cloned page directory to %p\n&quot;</span>,</div>
<div class="line"><span class="lineno">  114</span>            cloned_page_dir);</div>
<div class="line"><span class="lineno">  115</span> </div>
<div class="line"><span class="lineno">  116</span>  <span class="comment">// Test 8: 验证克隆的映射</span></div>
<div class="line"><span class="lineno">  117</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; kNumPages; ++i) {</div>
<div class="line"><span class="lineno">  118</span>    <span class="keywordtype">void</span>* va = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x300000 +</div>
<div class="line"><span class="lineno">  119</span>                                       i * <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">  120</span>    <span class="keywordtype">void</span>* pa = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x91000000 +</div>
<div class="line"><span class="lineno">  121</span>                                       i * <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>    <span class="keyword">auto</span> src_m = vm.GetMapping(user_page_dir, va);</div>
<div class="line"><span class="lineno">  124</span>    <span class="keyword">auto</span> dst_m = vm.GetMapping(cloned_page_dir, va);</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>    <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(src_m.has_value(),</div>
<div class="line"><span class="lineno">  127</span>                <span class="stringliteral">&quot;virtual_memory_test: source mapping lost after clone&quot;</span>);</div>
<div class="line"><span class="lineno">  128</span>    <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(dst_m.has_value(),</div>
<div class="line"><span class="lineno">  129</span>                <span class="stringliteral">&quot;virtual_memory_test: cloned mapping not found&quot;</span>);</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <span class="keywordflow">if</span> (src_m &amp;&amp; dst_m) {</div>
<div class="line"><span class="lineno">  132</span>      <a class="code hl_define" href="system__test_8h.html#abfc1b6826e51b93338e02cabfa5cfcd1">EXPECT_EQ</a>(*src_m, pa,</div>
<div class="line"><span class="lineno">  133</span>                <span class="stringliteral">&quot;virtual_memory_test: source mapping changed after clone&quot;</span>);</div>
<div class="line"><span class="lineno">  134</span>      <a class="code hl_define" href="system__test_8h.html#abfc1b6826e51b93338e02cabfa5cfcd1">EXPECT_EQ</a>(*dst_m, pa, <span class="stringliteral">&quot;virtual_memory_test: cloned mapping incorrect&quot;</span>);</div>
<div class="line"><span class="lineno">  135</span>      <a class="code hl_define" href="system__test_8h.html#abfc1b6826e51b93338e02cabfa5cfcd1">EXPECT_EQ</a>(*src_m, *dst_m,</div>
<div class="line"><span class="lineno">  136</span>                <span class="stringliteral">&quot;virtual_memory_test: source and clone mappings differ&quot;</span>);</div>
<div class="line"><span class="lineno">  137</span>    }</div>
<div class="line"><span class="lineno">  138</span>  }</div>
<div class="line"><span class="lineno">  139</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: verified cloned mappings\n&quot;</span>);</div>
<div class="line"><span class="lineno">  140</span> </div>
<div class="line"><span class="lineno">  141</span>  <span class="comment">// Test 9: 克隆页表（不复制映射）</span></div>
<div class="line"><span class="lineno">  142</span>  <span class="keyword">auto</span> clone_no_map_result = vm.ClonePageDirectory(user_page_dir, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  143</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(clone_no_map_result.has_value(),</div>
<div class="line"><span class="lineno">  144</span>              <span class="stringliteral">&quot;virtual_memory_test: failed to clone page dir (no mappings)&quot;</span>);</div>
<div class="line"><span class="lineno">  145</span>  <span class="keywordtype">void</span>* cloned_no_map = clone_no_map_result.value();</div>
<div class="line"><span class="lineno">  146</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: cloned page directory (no mappings) to %p\n&quot;</span>,</div>
<div class="line"><span class="lineno">  147</span>            cloned_no_map);</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>  <span class="comment">// 验证新页表没有映射</span></div>
<div class="line"><span class="lineno">  150</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; kNumPages; ++i) {</div>
<div class="line"><span class="lineno">  151</span>    <span class="keywordtype">void</span>* va = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x300000 +</div>
<div class="line"><span class="lineno">  152</span>                                       i * <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>    <span class="keyword">auto</span> m = vm.GetMapping(cloned_no_map, va);</div>
<div class="line"><span class="lineno">  155</span>    <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(!m.has_value(),</div>
<div class="line"><span class="lineno">  156</span>                <span class="stringliteral">&quot;virtual_memory_test: cloned (no map) should have no mappings&quot;</span>);</div>
<div class="line"><span class="lineno">  157</span>  }</div>
<div class="line"><span class="lineno">  158</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: verified no mappings in cloned page dir\n&quot;</span>);</div>
<div class="line"><span class="lineno">  159</span> </div>
<div class="line"><span class="lineno">  160</span>  <span class="comment">// Test 10: 在克隆的页表中添加新映射</span></div>
<div class="line"><span class="lineno">  161</span>  <span class="keywordtype">void</span>* new_va = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x400000);</div>
<div class="line"><span class="lineno">  162</span>  <span class="keywordtype">void</span>* new_pa = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x92000000);</div>
<div class="line"><span class="lineno">  163</span> </div>
<div class="line"><span class="lineno">  164</span>  <span class="keyword">auto</span> clone_map_result =</div>
<div class="line"><span class="lineno">  165</span>      vm.MapPage(cloned_no_map, new_va, new_pa,</div>
<div class="line"><span class="lineno">  166</span>                 <a class="code hl_function" href="namespacecpu__io_1_1virtual__memory.html#af2bed9d8a049c2d40634b15b8e3adca9">cpu_io::virtual_memory::GetUserPagePermissions</a>());</div>
<div class="line"><span class="lineno">  167</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(clone_map_result.has_value(),</div>
<div class="line"><span class="lineno">  168</span>              <span class="stringliteral">&quot;virtual_memory_test: failed to map in cloned page dir&quot;</span>);</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>  <span class="comment">// 验证只在克隆的页表中有映射</span></div>
<div class="line"><span class="lineno">  171</span>  <span class="keyword">auto</span> user_m = vm.GetMapping(user_page_dir, new_va);</div>
<div class="line"><span class="lineno">  172</span>  <span class="keyword">auto</span> clone_m = vm.GetMapping(cloned_no_map, new_va);</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(!user_m.has_value(),</div>
<div class="line"><span class="lineno">  175</span>              <span class="stringliteral">&quot;virtual_memory_test: mapping leaked to original page dir&quot;</span>);</div>
<div class="line"><span class="lineno">  176</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(clone_m.has_value(),</div>
<div class="line"><span class="lineno">  177</span>              <span class="stringliteral">&quot;virtual_memory_test: new mapping not in cloned page dir&quot;</span>);</div>
<div class="line"><span class="lineno">  178</span>  <span class="keywordflow">if</span> (clone_m) {</div>
<div class="line"><span class="lineno">  179</span>    <a class="code hl_define" href="system__test_8h.html#abfc1b6826e51b93338e02cabfa5cfcd1">EXPECT_EQ</a>(*clone_m, new_pa,</div>
<div class="line"><span class="lineno">  180</span>              <span class="stringliteral">&quot;virtual_memory_test: new mapping address incorrect&quot;</span>);</div>
<div class="line"><span class="lineno">  181</span>  }</div>
<div class="line"><span class="lineno">  182</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: verified independent mappings\n&quot;</span>);</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>  <span class="comment">// Test 11: 销毁页表</span></div>
<div class="line"><span class="lineno">  185</span>  vm.DestroyPageDirectory(user_page_dir, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  186</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: destroyed user page directory\n&quot;</span>);</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>  vm.DestroyPageDirectory(cloned_page_dir, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  189</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: destroyed cloned page directory\n&quot;</span>);</div>
<div class="line"><span class="lineno">  190</span> </div>
<div class="line"><span class="lineno">  191</span>  vm.DestroyPageDirectory(cloned_no_map, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  192</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: destroyed cloned (no map) page directory\n&quot;</span>);</div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span>  <span class="comment">// Test 12: 重新映射测试</span></div>
<div class="line"><span class="lineno">  195</span>  <span class="keywordtype">void</span>* test_page_dir = <a class="code hl_function" href="system__test_2virtual__memory__test_8cpp.html#a8006724372b77924155bd8618fe57516">aligned_alloc</a>(<a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>,</div>
<div class="line"><span class="lineno">  196</span>                                      <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">  197</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(test_page_dir != <span class="keyword">nullptr</span>,</div>
<div class="line"><span class="lineno">  198</span>              <span class="stringliteral">&quot;virtual_memory_test: failed to create test page dir&quot;</span>);</div>
<div class="line"><span class="lineno">  199</span>  std::memset(test_page_dir, 0, <a class="code hl_variable" href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a>);</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>  <span class="keywordtype">void</span>* test_va = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x500000);</div>
<div class="line"><span class="lineno">  202</span>  <span class="keywordtype">void</span>* test_pa1 = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x93000000);</div>
<div class="line"><span class="lineno">  203</span>  <span class="keywordtype">void</span>* test_pa2 = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(0x94000000);</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span>  <span class="comment">// 第一次映射</span></div>
<div class="line"><span class="lineno">  206</span>  vm.MapPage(test_page_dir, test_va, test_pa1,</div>
<div class="line"><span class="lineno">  207</span>             <a class="code hl_function" href="namespacecpu__io_1_1virtual__memory.html#af2bed9d8a049c2d40634b15b8e3adca9">cpu_io::virtual_memory::GetUserPagePermissions</a>());</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>  <span class="keyword">auto</span> m1 = vm.GetMapping(test_page_dir, test_va);</div>
<div class="line"><span class="lineno">  210</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(m1.has_value(), <span class="stringliteral">&quot;virtual_memory_test: first mapping failed&quot;</span>);</div>
<div class="line"><span class="lineno">  211</span>  <span class="keywordflow">if</span> (m1) {</div>
<div class="line"><span class="lineno">  212</span>    <a class="code hl_define" href="system__test_8h.html#abfc1b6826e51b93338e02cabfa5cfcd1">EXPECT_EQ</a>(*m1, test_pa1, <span class="stringliteral">&quot;virtual_memory_test: first mapping incorrect&quot;</span>);</div>
<div class="line"><span class="lineno">  213</span>  }</div>
<div class="line"><span class="lineno">  214</span> </div>
<div class="line"><span class="lineno">  215</span>  <span class="comment">// 重新映射到不同物理地址</span></div>
<div class="line"><span class="lineno">  216</span>  vm.MapPage(test_page_dir, test_va, test_pa2,</div>
<div class="line"><span class="lineno">  217</span>             <a class="code hl_function" href="namespacecpu__io_1_1virtual__memory.html#af2bed9d8a049c2d40634b15b8e3adca9">cpu_io::virtual_memory::GetUserPagePermissions</a>());</div>
<div class="line"><span class="lineno">  218</span> </div>
<div class="line"><span class="lineno">  219</span>  <span class="keyword">auto</span> m2 = vm.GetMapping(test_page_dir, test_va);</div>
<div class="line"><span class="lineno">  220</span>  <a class="code hl_define" href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a>(m2.has_value(), <span class="stringliteral">&quot;virtual_memory_test: remap failed&quot;</span>);</div>
<div class="line"><span class="lineno">  221</span>  <span class="keywordflow">if</span> (m2) {</div>
<div class="line"><span class="lineno">  222</span>    <a class="code hl_define" href="system__test_8h.html#abfc1b6826e51b93338e02cabfa5cfcd1">EXPECT_EQ</a>(*m2, test_pa2, <span class="stringliteral">&quot;virtual_memory_test: remap address incorrect&quot;</span>);</div>
<div class="line"><span class="lineno">  223</span>  }</div>
<div class="line"><span class="lineno">  224</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: verified remap from %p to %p\n&quot;</span>, test_pa1,</div>
<div class="line"><span class="lineno">  225</span>            test_pa2);</div>
<div class="line"><span class="lineno">  226</span> </div>
<div class="line"><span class="lineno">  227</span>  <span class="comment">// 清理</span></div>
<div class="line"><span class="lineno">  228</span>  vm.DestroyPageDirectory(test_page_dir, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  229</span> </div>
<div class="line"><span class="lineno">  230</span>  <a class="code hl_function" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a>(<span class="stringliteral">&quot;virtual_memory_test: all tests passed\n&quot;</span>);</div>
<div class="line"><span class="lineno">  231</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  232</span>}</div>
<div class="ttc" id="aclassSingleton_html_a68856b49e098eadba37b60366db33ebd"><div class="ttname"><a href="classSingleton.html#a68856b49e098eadba37b60366db33ebd">Singleton::GetInstance</a></div><div class="ttdeci">static auto GetInstance() -&gt; T &amp;</div><div class="ttdef"><b>Definition</b> <a href="singleton_8hpp_source.html#l00023">singleton.hpp:23</a></div></div>
<div class="ttc" id="anamespacecpu__io_1_1virtual__memory_html_a24fb424f54d414703cda572dc076d71a"><div class="ttname"><a href="namespacecpu__io_1_1virtual__memory.html#a24fb424f54d414703cda572dc076d71a">cpu_io::virtual_memory::kPageSize</a></div><div class="ttdeci">static constexpr size_t kPageSize</div><div class="ttdef"><b>Definition</b> <a href="cpu__io_8h_source.html#l00058">cpu_io.h:58</a></div></div>
<div class="ttc" id="anamespacecpu__io_1_1virtual__memory_html_af2bed9d8a049c2d40634b15b8e3adca9"><div class="ttname"><a href="namespacecpu__io_1_1virtual__memory.html#af2bed9d8a049c2d40634b15b8e3adca9">cpu_io::virtual_memory::GetUserPagePermissions</a></div><div class="ttdeci">auto GetUserPagePermissions(bool readable=true, bool writable=false, bool executable=false, bool global=false) -&gt; uint64_t</div><div class="ttdef"><b>Definition</b> <a href="cpu__io_8h_source.html#l00074">cpu_io.h:74</a></div></div>
<div class="ttc" id="ask__stdio_8h_html_ad8142b94111a30f723c6c0a2301bae7f"><div class="ttname"><a href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f">sk_printf</a></div><div class="ttdeci">int sk_printf(const char *format,...) __attribute__((format(printf</div></div>
<div class="ttc" id="asystem__test_2virtual__memory__test_8cpp_html_a8006724372b77924155bd8618fe57516"><div class="ttname"><a href="system__test_2virtual__memory__test_8cpp.html#a8006724372b77924155bd8618fe57516">aligned_alloc</a></div><div class="ttdeci">void * aligned_alloc(size_t alignment, size_t size)</div><div class="ttdef"><b>Definition</b> <a href="memory_8cpp_source.html#l00062">memory.cpp:62</a></div></div>
<div class="ttc" id="asystem__test_8h_html_a00a870caa41dce04e9db04bd0c2fca57"><div class="ttname"><a href="system__test_8h.html#a00a870caa41dce04e9db04bd0c2fca57">EXPECT_TRUE</a></div><div class="ttdeci">#define EXPECT_TRUE(cond, msg)</div><div class="ttdef"><b>Definition</b> <a href="system__test_8h_source.html#l00127">system_test.h:127</a></div></div>
<div class="ttc" id="asystem__test_8h_html_abfc1b6826e51b93338e02cabfa5cfcd1"><div class="ttname"><a href="system__test_8h.html#abfc1b6826e51b93338e02cabfa5cfcd1">EXPECT_EQ</a></div><div class="ttdeci">#define EXPECT_EQ(val1, val2, msg)</div><div class="ttdef"><b>Definition</b> <a href="system__test_8h_source.html#l00102">system_test.h:102</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="system__test_2virtual__memory__test_8cpp_a8027cdd5d224276fe32cfe407e4dfe88_cgraph.png" border="0" usemap="#asystem__test_2virtual__memory__test_8cpp_a8027cdd5d224276fe32cfe407e4dfe88_cgraph" alt=""/></div>
<map name="asystem__test_2virtual__memory__test_8cpp_a8027cdd5d224276fe32cfe407e4dfe88_cgraph" id="asystem__test_2virtual__memory__test_8cpp_a8027cdd5d224276fe32cfe407e4dfe88_cgraph">
<area shape="rect" title=" " alt="" coords="5,84,164,109"/>
<area shape="rect" href="memory_8cpp.html#a8006724372b77924155bd8618fe57516" title=" " alt="" coords="255,5,363,31"/>
<area shape="poly" title=" " alt="" coords="111,81,211,39,241,31,242,36,213,45,113,86"/>
<area shape="rect" href="classSingleton.html#a68856b49e098eadba37b60366db33ebd" title=" " alt="" coords="224,55,393,80"/>
<area shape="poly" title=" " alt="" coords="164,84,210,78,211,83,164,89"/>
<area shape="rect" href="namespacecpu__io_1_1virtual__memory.html#af2bed9d8a049c2d40634b15b8e3adca9" title=" " alt="" coords="212,105,405,145"/>
<area shape="poly" title=" " alt="" coords="164,104,199,108,198,114,164,109"/>
<area shape="rect" href="sk__stdio_8h.html#ad8142b94111a30f723c6c0a2301bae7f" title=" " alt="" coords="269,169,348,195"/>
<area shape="poly" title=" " alt="" coords="111,107,157,131,213,154,257,168,255,173,211,159,155,135,108,112"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_59425e443f801f1f2fd8bbe4959a3ccf.html">tests</a></li><li class="navelem"><a class="el" href="dir_9792f77b7388247cc984bf8bf02ef530.html">system_test</a></li><li class="navelem"><a class="el" href="system__test_2virtual__memory__test_8cpp.html">virtual_memory_test.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
